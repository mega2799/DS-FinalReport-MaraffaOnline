<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>main</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #ffffff;
        color: #a0a0a0;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b; background-color: #ffffff; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #b08000; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #1f1c1b; } /* Operator */
    code span.ot { color: #006e28; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #0057ae; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="latex2html.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#list-of-abbreviations" id="toc-list-of-abbreviations">List
of Abbreviations</a></li>
<li><a href="#glossario-dei-termini"
id="toc-glossario-dei-termini">Glossario dei termini</a></li>
<li><a href="#ch:into" id="toc-ch:into">Introduzione</a></li>
<li><a href="#ch:analisi" id="toc-ch:analisi">Analisi</a>
<ul>
<li><a href="#obiettivi" id="toc-obiettivi">Obiettivi</a></li>
<li><a href="#politiche-di-autovalutazione"
id="toc-politiche-di-autovalutazione">Politiche di
autovalutazione</a></li>
<li><a href="#requisiti-e-casi-duso"
id="toc-requisiti-e-casi-duso">Requisiti e casi d’uso</a>
<ul>
<li><a href="#requisiti" id="toc-requisiti">Requisiti</a></li>
<li><a href="#casi-duso" id="toc-casi-duso">Casi d’uso</a></li>
</ul></li>
</ul></li>
<li><a href="#ch:architectures" id="toc-ch:architectures">Architettura e
Design</a>
<ul>
<li><a href="#design-generale-del-software"
id="toc-design-generale-del-software">Design generale del
software</a></li>
<li><a href="#micro-servizi-e-la-loro-architettura"
id="toc-micro-servizi-e-la-loro-architettura">Micro-servizi e la loro
architettura</a>
<ul>
<li><a href="#servizio-per-gestione-utenti"
id="toc-servizio-per-gestione-utenti">Servizio per Gestione
Utenti</a></li>
<li><a href="#servizio-business-logic"
id="toc-servizio-business-logic">Servizio Business Logic</a></li>
<li><a href="#servizio-ponte-tra-i-microservizi"
id="toc-servizio-ponte-tra-i-microservizi">Servizio ponte tra i
microservizi</a></li>
</ul></li>
<li><a href="#dsspe-perche-i-microservizi"
id="toc-dsspe-perche-i-microservizi">[DS/SPE] Perche’ i
microservizi?</a>
<ul>
<li><a href="#vantaggi-dellarchitettura-a-microservizi"
id="toc-vantaggi-dellarchitettura-a-microservizi">Vantaggi
dell’architettura a microservizi</a></li>
</ul></li>
<li><a href="#servizi-di-business-logic-e-user-service"
id="toc-servizi-di-business-logic-e-user-service">Servizi di Business
Logic e User Service</a>
<ul>
<li><a href="#business-logic" id="toc-business-logic">Business
Logic</a></li>
<li><a href="#user-service" id="toc-user-service">User Service</a></li>
</ul></li>
<li><a href="#front-end" id="toc-front-end">Front-End</a></li>
<li><a href="#middleware" id="toc-middleware">Middleware</a>
<ul>
<li><a href="#struttura-api-gateway"
id="toc-struttura-api-gateway">Struttura API Gateway</a></li>
<li><a href="#websockets" id="toc-websockets">WebSockets</a></li>
</ul></li>
</ul></li>
<li><a href="#ch:interazioni"
id="toc-ch:interazioni">Interazioni</a></li>
<li><a href="#ch:implementazione"
id="toc-ch:implementazione">Implementazione</a>
<ul>
<li><a href="#tecnologie" id="toc-tecnologie">Tecnologie</a>
<ul>
<li><a href="#swagger---openapi" id="toc-swagger---openapi">Swagger -
OpenAPI</a></li>
<li><a href="#postman" id="toc-postman">Postman</a></li>
<li><a href="#log-automatici" id="toc-log-automatici">Log
automatici</a></li>
</ul></li>
<li><a href="#screen" id="toc-screen">Screen</a></li>
<li><a href="#optionalmockup"
id="toc-optionalmockup">Optional(Mockup)</a></li>
</ul></li>
<li><a href="#ch:DevOps" id="toc-ch:DevOps">DevOps</a>
<ul>
<li><a href="#dvcs" id="toc-dvcs">DVCS</a>
<ul>
<li><a href="#struttura-dei-branch"
id="toc-struttura-dei-branch">Struttura dei Branch</a></li>
<li><a href="#conventional-commits"
id="toc-conventional-commits">Conventional commits</a></li>
</ul></li>
<li><a href="#issue-template" id="toc-issue-template">Issue
template</a></li>
<li><a href="#continuous-integration"
id="toc-continuous-integration">Continuous integration</a></li>
<li><a href="#build-automation" id="toc-build-automation">Build
automation</a></li>
</ul></li>
<li><a href="#ch:validazione"
id="toc-ch:validazione">Validazione</a></li>
<li><a href="#ch:deployment" id="toc-ch:deployment">Deployment</a>
<ul>
<li><a href="#deployment" id="toc-deployment">deployment</a></li>
</ul></li>
<li><a href="#ch:con" id="toc-ch:con">Conclusions and Future Work</a>
<ul>
<li><a href="#conclusions" id="toc-conclusions">Conclusions</a></li>
<li><a href="#future-work" id="toc-future-work">Future work</a></li>
</ul></li>
</ul>
</nav>
<div class="titlepage">
<div class="center">
<p><span>Sistemi distribuiti</span><br />
</p>
<p>Maraffa Online</p>
<p> <br />
<span> Sofia Tosi Matteo Santoro </span><br />
<span> <em>Supervisors:</em> Giovanni Ciatto, Matteo Magnani, Andrea
Omicini </span><br />
</p>
<p>2024-07-08</p>
</div>
</div>
<h2 id="list-of-abbreviations">List of Abbreviations</h2>
<div class="abbrv">
<p>School of Mathematical, Physical and Computational Sciences</p>
<p>Computer Science</p>
<p>GitHub Pages</p>
<p>Continuous Integration</p>
</div>
<h2 id="glossario-dei-termini">Glossario dei termini</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Nome</strong></th>
<th style="text-align: left;"><strong>Descrizione</strong></th>
<th style="text-align: left;"><strong>Sinonimi</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mano</td>
<td style="text-align: left;">Distribuzione delle 40 carte ai 4
giocatori e la seguente serie di 10 prese</td>
<td style="text-align: left;">Round</td>
</tr>
<tr class="even">
<td style="text-align: left;">Presa</td>
<td style="text-align: left;">Quando ogni giocatore, a turno, gioca sul
tavolo una carta. L’ultima presa della mano vale 1 punto.</td>
<td style="text-align: left;">Trick</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Partita</td>
<td style="text-align: left;">Insieme di più mani fino al raggiungimento
del punteggio di 41 punti.</td>
<td style="text-align: left;">Game</td>
</tr>
<tr class="even">
<td style="text-align: left;">Partita corta</td>
<td style="text-align: left;">Insieme di più mani fino al raggiungimento
del punteggio di 31 punti.</td>
<td style="text-align: left;">Short Game</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tavolo</td>
<td style="text-align: left;">Raggruppamento di 4 giocatori, suddivisi
in 2 coppie, i giocatori delle stessa squadra “siedono” in direzione
opposta</td>
<td style="text-align: left;">Table</td>
</tr>
<tr class="even">
<td style="text-align: left;">Seme</td>
<td style="text-align: left;">Tipologia distintiva di carta, ne esistono
4:</td>
<td style="text-align: left;"> </td>
</tr>
<tr class="odd">
<td style="text-align: left;">- Denari</td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
</tr>
<tr class="even">
<td style="text-align: left;">- Coppe</td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
</tr>
<tr class="odd">
<td style="text-align: left;">- Spade</td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
</tr>
<tr class="even">
<td style="text-align: left;">- Bastoni</td>
<td style="text-align: left;">Suit: -Coins -Cups -Swords -Clubs</td>
<td style="text-align: left;"> </td>
</tr>
<tr class="odd">
<td style="text-align: left;">Briscola</td>
<td style="text-align: left;">Seme con priorita’ piu’ alta.</td>
<td style="text-align: left;">Trump</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maraffa</td>
<td style="text-align: left;">Se un giocatore possiede le tre carte di
valore maggiore (asso, due e tre, dette assieme "Maraffa" o "Cricca")
del seme di briscola, vince tre punti addizionali. In questo caso deve
scendere con l’asso di quel seme.</td>
<td style="text-align: left;">Cricca, Marafon, Tresette con la
Briscola</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mazzo</td>
<td style="text-align: left;">40 carte, di 4 semi diversi</td>
<td style="text-align: left;"> </td>
</tr>
<tr class="even">
<td style="text-align: left;">1,2,3,4,5,6,7, fante, cavallo e re.</td>
<td style="text-align: left;">Deck</td>
<td style="text-align: left;"> </td>
</tr>
<tr class="odd">
<td style="text-align: left;">Taglio</td>
<td style="text-align: left;">Durante una mano in un seme viene giocato
il seme di briscola, che avendo priorita’ maggiore permette di prendere
nonostante il seme di gioco</td>
<td style="text-align: left;">Cut</td>
</tr>
<tr class="even">
<td style="text-align: left;">Busso</td>
<td style="text-align: left;">Invita il compagno, se possibile, a
conquistare la presa e ad aprire il turno successivo con lo stesso
seme</td>
<td style="text-align: left;">Knock</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Striscio corto</td>
<td style="text-align: left;">Quando si ha ancora in mano un basso
numero di carte dello stesso seme con cui si è aperto il turno.</td>
<td style="text-align: left;">Short strip</td>
</tr>
<tr class="even">
<td style="text-align: left;">Striscio lungo</td>
<td style="text-align: left;">Quando si ha ancora in mano molte carte
dello stesso seme con cui si è aperto il turno.</td>
<td style="text-align: left;">Long strip</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Volo</td>
<td style="text-align: left;">Quando non si hanno più carte del seme con
cui si è aperto il turno.</td>
<td style="text-align: left;">Fly</td>
</tr>
<tr class="even">
<td style="text-align: left;">Figura</td>
<td style="text-align: left;">Fante, Cavallo, Re, con punteggio di 1/3
di punto.</td>
<td style="text-align: left;">Figure</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asso</td>
<td style="text-align: left;">Carta con valore di 1 punto.</td>
<td style="text-align: left;">Ace</td>
</tr>
<tr class="even">
<td style="text-align: left;">Due e Tre</td>
<td style="text-align: left;">Carte con valore 1/3 di punto.</td>
<td style="text-align: left;">Two and Three</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Carta Liscia</td>
<td style="text-align: left;">Carte con numeri 4, 5, 6, 7. Sono prive di
valore</td>
<td style="text-align: left;">Smooth paper</td>
</tr>
<tr class="even">
<td style="text-align: left;">Squadra</td>
<td style="text-align: left;">Coppie di giocatori seduti opposti</td>
<td style="text-align: left;">Team</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Giocatore</td>
<td style="text-align: left;">Persona che interagisce con
l’applicativo</td>
<td style="text-align: left;">Player, User</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chiamata fuori</td>
<td style="text-align: left;">Se un giocatore pensa che la sua squadra
abbia raggiunto i 41 punti (o 31 punti nella variante "corta" della
partita), la squadra può dichiarare di avere già nel mazzo delle prese i
punti per vincere e chiudere in anticipo l’ultima partita. In questo
modo la mano termina immediatamente, senza che vengano giocate le
restanti prese e la squadra che si è "chiamata fuori" impedisce
all’altra squadra di conquistare ulteriori prese. Se una squadra si
chiama fuori e, dopo aver contato i punti delle prese effettuate ed
averli sommati ai punti ottenuti nelle mani già giocate, non raggiunge i
punti per la vittoria (in gergo "sbaglia la chiamata") scatta automatico
l’11 a 0 per la squadra avversaria</td>
<td style="text-align: left;">Call out</td>
</tr>
<tr class="odd">
<td style="text-align: left;">non abbiamo messo l’altro significato di
mano</td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
</tr>
</tbody>
</table>
<h1 id="ch:into">Introduzione</h1>
<p>MaraffaOnline è un’applicazione che permette alle persone di giocare
al gioco di carte <a
href="https://it.wikipedia.org/wiki/Marafone_Beccacino">Maraffa/Beccacino</a>.
Il progetto consiste nell’eseguire una manutenzione evolutiva del gioco
di carte reperibile su MaraffaOnline, attualmente sviluppato dalla
prof.ssa Lumini. In particolare la nuova versione avrà un’architettura a
microservizi e introdurrà anche nuove funzionalità come formazione
personalizzata delle squadre, una nuova modalità di gioco (vittoria 11 a
0 in caso di violazione delle regole da parte di una squadra),
salvataggio delle statistiche delle partite e degli utenti, ...<br />
Per realizzare questa evoluzione, il progetto sarà suddiviso in diverse
fasi, ognuna delle quali si concentrerà su un aspetto specifico
dell’architettura e delle funzionalità.</p>
<p>La prima fase riguarderà la decomposizione dell’applicazione
monolitica esistente in microservizi indipendenti, che comunicheranno
tra loro attraverso API RESTful.</p>
<p>Nella seconda fase, saranno sviluppati i sistemi di salvataggio delle
statistiche e la chat. Le statistiche di gioco saranno memorizzate in un
database relazionale, permettendo agli utenti di visualizzare le loro
performance nel tempo e confrontarsi con altri giocatori. Il gioco
disporrà di due chat: una globale, accessibile a tutti gli utenti, e una
relativa alla partita, accessibile solo ai giocatori della partita in
corso.</p>
<p>La terza fase si concentrerà sull’implementazione delle nuove
funzionalità, partendo dalla formazione personalizzata delle squadre
fino alla modalità 11 a 0, la quale assicurerà che le violazioni delle
regole siano rilevate automaticamente.</p>
<p>Il progetto sarà gestito utilizzando metodologie agili, con sprint di
sviluppo e feedback continuo da parte degli utenti. In questo modo, sarà
possibile adattare rapidamente il piano di lavoro in base ai consigli,
garantendo al contempo un prodotto finale di alta qualità e in linea con
le aspettative degli utenti.</p>
<h1 id="ch:analisi">Analisi</h1>
<h2 id="obiettivi">Obiettivi</h2>
<p>I principali requisiti funzionali e obiettivi del sistema sono:</p>
<ul>
<li><p><strong>Costruzione di un’architettura a
micro-servizi</strong>.</p></li>
<li><p><strong>Autenticazione e registrazione utenti:</strong>
possibilità di accedere ad un’area privata per poter visualizzare
informazioni personali, oltre alla possibilità di poter giocare senza un
proprio account in modalità ’ospite’.</p></li>
<li><p><strong>Creazione e gestione partita:</strong> gli utenti possono
creare o partecipare ad una partita che inizierà soltanto quando 4
giocatori saranno presenti e disposti in due squadre da 2.</p></li>
<li><p><strong>Chat di gioco:</strong> possibilità di scambiare
messaggi.</p></li>
<li><p><strong>Nuova modalità di gioco</strong> in cui se si commette un
errore di gioco la partita viene conclusa conferendo alla squadra
avversaria il massimo dei punti.</p></li>
<li><p><strong>Persistenza dei dati:</strong> salvataggio su database
degli utenti e delle statistiche delle partite (mani giocate, briscola,
etc...).</p></li>
</ul>
<h2 id="politiche-di-autovalutazione">Politiche di autovalutazione</h2>
<ul>
<li><p>l’elenco delle partite iniziate/finite deve rimanere
aggiornato</p></li>
<li><p>se un giocatore si disconnette la partita termina per tutti
(analizzando i casi pratici si è notato che quando un giocatore si
disconnette è perchè non ha intenzione di rientrare, è pertanto inutile
far attendere gli altri giocatori per una possibile
riconnessione)</p></li>
<li><p>nel caso di connessione lenta o malfunzionamenti da parte di un
giocatore, il giocatore potrà rimanere sempre aggiornato sullo stato
corrente della partita riaggiornado la pagina</p></li>
<li><p>quando un giocatore clicca sul tasto "esci", verrà comunicato a
tutti gli altri giocatori che la partita è terminata e verranno
reindirizzati alla schermata principale</p></li>
<li><p>nel caso di un crash di un servizio si deve garantire che il
servizio venga riavviato in automatico evitando che il sistema si
blocchi</p></li>
</ul>
<h2 id="requisiti-e-casi-duso">Requisiti e casi d’uso</h2>
<h3 id="requisiti">Requisiti</h3>
<ol>
<li><p>Account</p>
<ol>
<li><p>Login</p></li>
<li><p>Registrazione</p></li>
<li><p>Recupero password</p></li>
<li><p>Visualizzazione profilo</p></li>
<li><p>Modifica password</p></li>
<li><p>Possibilità di scegliere se giocare come ospite o effettuare il
login</p></li>
</ol></li>
<li><p>Realizzazione partita</p>
<ol>
<li><p>Creazione partita</p></li>
<li><p>Partecipazione partita</p></li>
<li><p>gioca carta</p></li>
<li><p>Inizio partita</p></li>
<li><p>Fine mano</p></li>
<li><p>Fine partita</p></li>
</ol></li>
<li><p>Chat di gioco</p>
<ol>
<li><p>chat globale</p></li>
<li><p>chat partita</p></li>
</ol></li>
<li><p>Possibilità di scegliere un compagno di squadra</p></li>
<li><p>Scelta del seme, parole consentite</p></li>
<li><p>Modalità di gioco 11 a 0</p></li>
<li><p>Gestione punteggio</p>
<ol>
<li><p>Calcolo totale e parziale (Gestione per ogni mano) del
punteggio</p></li>
<li><p>Maraffa/Cricca (+3 punti)</p></li>
</ol></li>
<li><p>Servizio gestione utenti</p></li>
<li><p>Salvataggio statistiche</p></li>
<li><p>Realizzazione GUI</p>
<ol>
<li><p>Refactor della GUI esistente</p></li>
<li><p>Rinnovamento GUI</p></li>
</ol></li>
</ol>
<h3 id="casi-duso">Casi d’uso</h3>
<p>Si riporta di seguito lo schema dei casi d’uso che modella
l’interazione dell’utente con l’applicazione.</p>
<figure id="use_case">
<img src="report/img/Casi_duso.png" />
<figcaption>Casi d’uso</figcaption>
</figure>
<h1 id="ch:architectures">Architettura e Design</h1>
<h2 id="design-generale-del-software">Design generale del software</h2>
<p>L’architettura del software è basata su micro-servizi autonomi e
indipendenti tra loro e la loro comunicazione avviene tramite API REST.
Esiste un middleware che si occupa della gestione e dell’orchestrazione
dei micro-servizi, facendo appunto da ponte collegando le varie diverse
tencologie.</p>
<p>I microservizi che si sono scelti di sviluppare si occupano di varie
aree legate alla natura del progetto e sono:</p>
<ul>
<li><p><strong>UserService</strong>: si occupa della gestione degli
utenti, quindi la loro registrazione, autenticazione e gestione dei dati
personali.</p></li>
<li><p><strong>BusinessLogic</strong>: si occupa di mantenere al proprio
interno tutte le regole proprie del gioco</p></li>
<li><p><strong>Front-End</strong>: si occupa di gestire l’interfaccia
grafica e la comunicazione con il middleware.</p></li>
<li><p><strong>Middleware</strong>: si occupa della gestione delle
comunicazioni tra i vari microservizi, e svolge la funzione di "motore
di gioco".</p></li>
</ul>
<p><img src="report/img/Architecture.png" style="width:12cm"
alt="image" /><br />
</p>
<h2 id="micro-servizi-e-la-loro-architettura">Micro-servizi e la loro
architettura</h2>
<h3 id="servizio-per-gestione-utenti">Servizio per Gestione Utenti</h3>
<div id="tab:user_serv_table">
<table>
<caption>Tabella descrittiva User Service</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Linguaggio</td>
<td style="text-align: left;">Node.JS/TypeScript</td>
</tr>
<tr class="even">
<td style="text-align: left;">Framework</td>
<td style="text-align: left;">NestJS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Persistence</td>
<td style="text-align: left;">Mysql</td>
</tr>
<tr class="even">
<td style="text-align: left;">Librerie</td>
<td style="text-align: left;">TypeORM</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Architettura</td>
<td style="text-align: left;">Model-Controller-service</td>
</tr>
</tbody>
</table>
</div>
<h3 id="servizio-business-logic">Servizio Business Logic</h3>
<div id="tab:bl_serv_table">
<table>
<caption>Tabella descrittiva Business Logic</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Linguaggio</td>
<td style="text-align: left;">Node.JS/TypeScript</td>
</tr>
<tr class="even">
<td style="text-align: left;">Framework</td>
<td style="text-align: left;">NestJS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Architettura</td>
<td style="text-align: left;">Model-Controller-service</td>
</tr>
</tbody>
</table>
</div>
<h3 id="servizio-ponte-tra-i-microservizi">Servizio ponte tra i
microservizi</h3>
<div id="tab:middleware_serv_table">
<table>
<caption>Tabella descrittiva Middleware</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Linguaggio</td>
<td style="text-align: left;">Java</td>
</tr>
<tr class="even">
<td style="text-align: left;">Server</td>
<td style="text-align: left;">Vertx</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Librerie</td>
<td style="text-align: left;">RabbitMQ(vertx)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Architettura</td>
<td style="text-align: left;">Multi-agent, motore di gioco</td>
</tr>
</tbody>
</table>
</div>
<h2 id="dsspe-perche-i-microservizi">[DS/SPE] Perche’ i
microservizi?</h2>
<p>Ogni microservizio si occupa di gestire un singolo ambito di
progetto, il che fa sì che si ottengano ottimi risultati riguardo la
qualità e l’affidabilità, la riutilizzabilità, la flessibilità e la
scalabilità. Tutti i componenti sono "loosely coupled", distribuiti in
modo indipendente, altamente collaudabili e gestibili e in ambiti reali
gestiti da un piccolo team. Tuttavia, non si tratta di una soluzione
definitiva, ha anche degli svantaggi come ad esempio:</p>
<ul>
<li><p>la complessità di gestione e la necessità di un’infrastruttura di
rete molto complessa.</p></li>
<li><p>un’ottima comunicazione di team.</p></li>
<li><p>una discreta capacità di astrazione e progettazione di
interfaccie di comunicazione che devono essere rispettate da tutti i
microservizi.</p></li>
<li><p>Non si ha la certezza che l’infrastruttura funzioni correttamente
fino a quando tutti i servizi non cooperano tra loro.</p></li>
</ul>
<h3 id="vantaggi-dellarchitettura-a-microservizi">Vantaggi
dell’architettura a microservizi</h3>
<h4 id="fault-tolerance">Fault Tolerance</h4>
<p>Progettare un sistema completamente privo di errori è un obiettivo
decisamente ambizioso e molto difficile da raggiungere. Molto più
realistico, e inerente al nostro percorso, è progettare un sistema che
sia in grado di tollerare, nella giusta misura, gli errori che
inevitabilmente si verificheranno. La scelta di questa architettura tra
i vari vantaggi offre la possibilità di <strong>isolare parti del
sistema</strong>, evitando che gli errori si propaghino in modo
incontrollato e che il sistema nel suo complesso vada in crash. Ogni
sistema opera in modo indipendente e autonomo, con le proprie risorse e
la propria logica.</p>
<p>Lo snodo centrale di comunicazione dei servizi, il middleware, è in
grado di gestire le comunicazioni tra i vari microservizi e di garantire
che il sistema sia in grado di funzionare anche in caso di guasti.
Purtroppo non esiste alcun progetto senza alcun tipo di <strong>single
point of failure</strong>, o almeno non con le risorse a disposizione di
noi studenti, quindi all’interno di questo servizio la gestione degli
errori dei servizi con cui comunica è gestita, ma di fatto, nel caso in
cui il middleware smetta di funzionare, non avendo nessun altro servizio
che possa fare da garante per il suo corretto funzionamento, tutto il
sistema non permetterà, ad esempio, di giocare a nessun gioco. Questo
perché il middleware è il cuore pulsante del sistema; avendo
disponibilità di risorse e abbastanza conoscenze in un ambito reale,
questo problema ha soluzioni:</p>
<ul>
<li><p><strong>Backup del middleware</strong>: avere dei backup dei
processi che si occupano di gestire le partite, ma questo
significherebbe andare a modificare inevitabilmente la struttura già
esistente del servizio.</p></li>
<li><p><strong>Ridondanza del middleware</strong>: avere molteplici
istanze del middleware, preferibilmente 3, di cui una principale e le
altre 2 in copia, facendo in modo che ogni azione sul middleware
principale venga replicata sulle altre due istanze e che quindi, in caso
di guasto hardware, le altre copie possano rispondere alle richieste. Se
si utilizza questa soluzione bisogna prestare attenzione alla
consistenza delle copie. La non consistenza potrebbe addirittura
peggiorare la situazione. Per questo motivo è consigliato averne più di
una, in modo tale da controllarne la consistenza.</p></li>
</ul>
<h4 id="scalabilità">Scalabilità</h4>
<p>Nel caso del middleware, la scalabilità è un altro modo per chiamare
la duplicazione, ma questo si applica soltanto al middleware, in quanto
gli altri microservizi sono realmente scalabili. Ogni microservizio è in
grado di scalare in modo indipendente, in base alle proprie esigenze, e
questo permette di avere un sistema che si adatta in modo dinamico alle
richieste degli utenti. Nella prossima sezione verrà approfondito come
il deployment con Docker permetta di scalare i microservizi.
L’implementazione di un sistema di load balancing viene fornita
"gratuitamente" da Kubernetes, che permette di bilanciare il carico tra
i vari nodi del cluster. Qualora il progetto maraffa-online dovesse
avere un numero di utenti molto elevato, si potrebbe pensare di scalare
il sistema in modo orizzontale, aggiungendo nuovi nodi al cluster, e
tramite la dovuta configurazione, Kubernetes si occuperebbe di
bilanciare il carico tra i vari nodi dei servizi scalabili.</p>
<h4 id="docker">Docker</h4>
<p>Suddividere un progetto monolitico in servizi a sé stanti permette di
dockerizzare comodamente ogni servizio e questo consente di avere un
sistema facilmente deployabile, versionabile e portabile. Uno dei
requisiti fondamentali del progetto era riuscire a dockerizzare
interamente il sistema. Nel caso in cui si volesse fare un deploy su un
server remoto, sarebbe sufficiente avere Docker installato, accedere al
docker-compose del progetto, settare le corrette variabili d’ambiente e
poi il progetto opererebbe in totale autonomia. Inoltre, utilizzare uno
stack permette anche di gestire eventuali failure dei servizi in modo
più semplice, poiché Docker consente di avere un sistema fault-tolerant.
Se un servizio dovesse andare in crash per qualche motivo inspiegabile,
Docker si occuperebbe di riavviarlo in modo autonomo. L’utilizzo di uno
stack permette anche di scalare i servizi in modo più semplice, poiché
basta settare il numero di repliche desiderate per un servizio e Docker
si occuperà di creare le repliche e di bilanciare il carico tra di esse.
Questo è un vantaggio nel caso in cui si voglia scalare il sistema in
modo orizzontale, ovvero aumentando le instanze di un singolo
servizio.</p>
<h2 id="servizi-di-business-logic-e-user-service">Servizi di Business
Logic e User Service</h2>
<p>Entrambi questi servizi sono stati realizzati con lo stack NestJS, un
framework per Node.js che semplifica la realizzazione di web server e
API REST. Si occupano rispettivamente di gestire la logica di gioco e la
gestione degli utenti che vogliono utilizzare il sistema, due core
business del progetto.</p>
<h3 id="business-logic">Business Logic</h3>
<p>Questo servizio mantiene al proprio interno tutte le regole del gioco
e il calcolo dei punteggi. Ha svariati endpoint che permettono al
middleware di avere il minor numero possibile di responsabilità,
delegando al servizio di business logic le operazioni riguardanti il
gioco.</p>
<p>Questa scelta è stata fatta per mantenere il middleware il più
leggero possibile e per evitare che si occupi di operazioni non di sua
competenza. Inoltre, in futuro sarà possibile aggiungere nuovi giochi
modificando il meno possibile il middleware, che dovrà semplicemente
occuparsi della gestione delle partite e comunicare tempestivamente con
i servizi di business logic in base al gioco scelto.</p>
<h3 id="user-service">User Service</h3>
<p>Questo servizio gestisce gli utenti, quindi la loro registrazione,
autenticazione e gestione dei dati personali. Anche in questo caso, il
middleware delega al servizio di gestione degli utenti le operazioni
riguardanti gli utenti, per mantenere il middleware il più leggero
possibile e per evitare che si occupi di operazioni non di sua
competenza. Il core di questo servizio è dato dalla combinazione di
NestJS e TypeORM, che permettono di gestire in modo semplice e veloce la
persistenza dei dati e le operazioni CRUD su un database MySQL. Oltre
alle informazioni degli utenti, il database contiene anche le
informazioni riguardanti le partite giocate e le statistiche personali
di ogni utente del sistema.</p>
<h2 id="front-end">Front-End</h2>
<p>Il front-end è stato realizzato con Angular e si occupa di gestire
l’interfaccia grafica e la comunicazione con il middleware. Sono state
realizzate diverse pagine, tra cui la home page, la pagina di
registrazione, la pagina di login, la pagina di gioco e la pagina di
profilo utente. Utilizza API REST per comunicare con il middleware e
ottenere i dati necessari per il funzionamento del gioco, mentre
utilizza WebSockets per la comunicazione in tempo reale con il
middleware.</p>
<h2 id="middleware">Middleware</h2>
<p><img src="report/img/middleware.png" style="width:12cm"
alt="image" /><br />
Come già citato, il middleware è il cuore del sistema. L’architettura
utilizzata per la gestione delle partite è quella di un multi-agente, in
cui ogni agente si occupa di gestire una partita e di orchestrare la
comunicazione con gli altri servizi, come ad esempio il front-end.
Questo core è stato realizzato con Vertx, che è stato utilizzato anche
per creare un web-server in Java.</p>
<p>Inoltre, al middleware è collegato un database NoSQL su MongoDB, che
viene aggiornato a ogni trick completato dai giocatori per creare uno
storico delle partite e salvare le loro decisioni in gioco. Questa
raccolta di dati sarà parte di uno sviluppo futuro, in cui, dopo aver
raccolto una grande quantità di dati di partite, si potrà tentare di
creare un modello di machine learning per sviluppare un’intelligenza
artificiale che possa giocare al posto di un giocatore umano.</p>
<h3 id="struttura-api-gateway">Struttura API Gateway</h3>
<p>Il pattern di progettazione utilizzato per la realizzazione del
middleware è quello dell’API Gateway, che permette di creare
un’interfaccia unica per l’accesso ai vari servizi del sistema.</p>
<p>Nel nostro progetto, il client effettua semplici chiamate verso il
middleware, che nei casi necessari effettua chiamate verso altri servizi
per svolgere una determinata operazione. Queste chiamate non sono
obbligatoriamente dirette verso il servizio interessato, ma possono
anche essere routine che effettuano molteplici chiamate per ottenere il
risultato desiderato. Implementare queste chiamate direttamente nel
front-end avrebbe reso il codice molto più complesso e difficile da
mantenere, e la gestione di partite multiple sarebbe stata molto più
difficile.</p>
<p>Non è stato implementato nessun meccanismo di discovery per la
gestione di chiamate verso gli altri servizi, in quanto tutti presenti
sullo stesso server e nello stesso stack di Docker, quindi facilmente
individuabili sulla rete virtuale creata da Docker.</p>
<p>Si è seguito un approccio modulare nello sviluppo di questo
componente che, in un primo step, conteneva soltanto la logica di
gestione delle partite, al quale sono stati aggiunti i moduli per la
comunicazione con il servizio degli utenti e della business logic. Ogni
modulo segue la stessa struttura, ossia una classe denominata controller
che si occupa esclusivamente della dichiarazione delle rotte HTTP e che
a sua volta contiene un service. Ogni servizio contiene poi le logiche
di calcolo e crea un JSON di risposta che viene passato al controller
che lo invia come risposta HTTP, questo per poter separare completamente
e rispettare il principio di single responsibility.</p>
<p>Nel modulo contenente le logiche di gioco è stato necessario
aggiungere un ulteriore strato alla struttura controller-service, data
la struttura multi-agente della gestione delle partite che non
permetteva una separazione netta. Quindi è stato aggiunto, tra il
controller e il service, un componente ibrido per poter comunque avere
servizi indipendenti.</p>
<p>Questa separazione, oltre a essere una buona pratica, è stata scelta
per poter effettuare del testing comodamente soltanto sui servizi,
testando quindi solamente la parte relativa all’elaborazione di una
risposta.</p>
<h3 id="websockets">WebSockets</h3>
<p>L’interazione con il frontend avviene prevalentemente tramite il
protocollo HTTP, ma per la gestione di alcuni aspetti in tempo reale
sono state introdotte le WebSocket. Questo componente è stato creato, ad
esempio, per la gestione delle chat di gioco, in modo che i giocatori
possano comunicare tra loro in tempo reale. Ogni client, istanziato sul
computer degli utenti, effettua una connessione WebSocket con il
middleware utilizzando come endpoint il proprio UUID, che viene
assegnato automaticamente all’avvio, e lo username del giocatore, dopo
aver effettuato il login. Il middleware contiene al proprio interno una
mappa di tutti i client e giocatori connessi con la relativa WebSocket e
una classe che espone due metodi per inviare messaggi a un singolo
giocatore o effettuare un messaggio broadcast a tutti i giocatori
connessi.</p>
<p>Il modulo di game si occupa di gestire le partite, quindi è l’unico
che può sapere quali giocatori devono ricevere determinati messaggi
relativi a una singola partita. Per utilizzare il servizio di WebSocket,
è stata implementata una semplice interfaccia all’interno dell’agente di
gioco con la quale si effettuano chiamate "onEvent". Ogni volta che un
particolare evento si verifica, un’invocazione a queste chiamate
permette di inviare messaggi alle WebSocket dei giocatori
interessati.</p>
<div class="sourceCode" id="list:java_websocket_interface"
data-language="Java"
data-caption="Interfaccia per gestire chiamate websocket"
label="list:java_websocket_interface"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:java_websocket_interface-1"><a href="#list:java_websocket_interface-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> game</span><span class="op">;</span></span>
<span id="list:java_websocket_interface-2"><a href="#list:java_websocket_interface-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-3"><a href="#list:java_websocket_interface-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">game</span><span class="op">.</span><span class="im">service</span><span class="op">.</span><span class="im">User</span><span class="op">;</span></span>
<span id="list:java_websocket_interface-4"><a href="#list:java_websocket_interface-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-5"><a href="#list:java_websocket_interface-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IGameAgent <span class="op">{</span></span>
<span id="list:java_websocket_interface-6"><a href="#list:java_websocket_interface-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-7"><a href="#list:java_websocket_interface-7" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onCreateGame</span><span class="op">(</span>User user<span class="op">);</span></span>
<span id="list:java_websocket_interface-8"><a href="#list:java_websocket_interface-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-9"><a href="#list:java_websocket_interface-9" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onNewRound</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-10"><a href="#list:java_websocket_interface-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-11"><a href="#list:java_websocket_interface-11" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onJoinGame</span><span class="op">(</span>User user<span class="op">);</span></span>
<span id="list:java_websocket_interface-12"><a href="#list:java_websocket_interface-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-13"><a href="#list:java_websocket_interface-13" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onStartGame</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-14"><a href="#list:java_websocket_interface-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-15"><a href="#list:java_websocket_interface-15" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onCheckMaraffa</span><span class="op">(</span><span class="dt">int</span> suit<span class="op">,</span> <span class="bu">String</span> username<span class="op">);</span></span>
<span id="list:java_websocket_interface-16"><a href="#list:java_websocket_interface-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-17"><a href="#list:java_websocket_interface-17" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onPlayCard</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-18"><a href="#list:java_websocket_interface-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-19"><a href="#list:java_websocket_interface-19" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onTrickCompleted</span><span class="op">(</span>Trick latestTrick<span class="op">);</span></span>
<span id="list:java_websocket_interface-20"><a href="#list:java_websocket_interface-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-21"><a href="#list:java_websocket_interface-21" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onMessage</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-22"><a href="#list:java_websocket_interface-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-23"><a href="#list:java_websocket_interface-23" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onEndRound</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-24"><a href="#list:java_websocket_interface-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-25"><a href="#list:java_websocket_interface-25" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onEndGame</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-26"><a href="#list:java_websocket_interface-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-27"><a href="#list:java_websocket_interface-27" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onNewGame</span><span class="op">(</span><span class="bu">String</span> newGameID<span class="op">);</span></span>
<span id="list:java_websocket_interface-28"><a href="#list:java_websocket_interface-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-29"><a href="#list:java_websocket_interface-29" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onChangeTeam</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-30"><a href="#list:java_websocket_interface-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-31"><a href="#list:java_websocket_interface-31" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onMakeCall</span><span class="op">(</span><span class="dt">final</span> Call call<span class="op">);</span></span>
<span id="list:java_websocket_interface-32"><a href="#list:java_websocket_interface-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="ch:interazioni">Interazioni</h1>
<p>interazioni tra i componenti, come comunicano, diagrammi d’attività.
(parlare di api gateway (permette comunicazione tra client esterni con i
microservizi, redireziona le richieste ai servizi))</p>
<h1 id="ch:implementazione">Implementazione</h1>
<p>parla di decomposizione delle funzionalità in microservizi dipendenze
minime tra i servizi reattività agli eventi</p>
<h2 id="tecnologie">Tecnologie</h2>
<p>(-swagger, -postman, autogenerazione javadoc?, JWT per autenticazione
utenti, docker, nodejs, typescript, mongodb, jest, angular, figma,
...)</p>
<h3 id="swagger---openapi">Swagger - OpenAPI</h3>
<p>Uno dei requisiti fondamentali di questo progetto è stata la
documentazione delle API. Per fare ciò è stato utilizzato Swagger, un
framework open-source che permette di descrivere, produrre e consumare
servizi web RESTful. Swagger permette di testare le API direttamente
dalla documentazione, grazie a un’interfaccia grafica che consente di
inviare richieste e visualizzare le risposte.</p>
<p>Per i servizi creati in Node.js è stata utilizzata una libreria ad
hoc, in grado di generare la documentazione automaticamente tramite i
corretti decoratori. Al contrario, per i servizi in Java non esiste
alcuna libreria in grado di generare automaticamente la documentazione
API a partire dai metodi esposti, quindi è stata creata manualmente.
Grazie a un lavoro preliminare open-source svolto da <a
href="https://github.com/anupsaund"><u>Anup Saund</u></a> sulla sua
repository <a
href="https://github.com/anupsaund/vertx-auto-swagger"><u>Vertx auto
swagger</u></a>, è stato possibile creare automaticamente un file HTML
contenente la documentazione delle API esposte dai servizi in Java.
Purtroppo, questo file non era in grado di aggiornarsi automaticamente
in caso di modifiche alle rotte, quindi è stato necessario adattarlo per
renderlo più flessibile e adatto al nostro progetto.</p>
<p>Vertx è una libreria davvero completa e ben strutturata. È stato
possibile creare un Router in grado di gestire tutte le rotte del
progetto in Java utilizzando una semplice classe astratta che ha
definito tutti i metodi utilizzati nel progetto, tramite la quale si è
potuto razionalizzare il codice e creare dinamicamente la funzionalità
richiesta.</p>
<div class="sourceCode" id="list:java_swagger_interface"
data-language="Java"
data-caption="Semplice interfaccia per le rotte HTTP"
label="list:java_swagger_interface"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:java_swagger_interface-1"><a href="#list:java_swagger_interface-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> httpRest</span><span class="op">;</span></span>
<span id="list:java_swagger_interface-2"><a href="#list:java_swagger_interface-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_swagger_interface-3"><a href="#list:java_swagger_interface-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">io</span><span class="op">.</span><span class="im">vertx</span><span class="op">.</span><span class="im">core</span><span class="op">.</span><span class="im">Handler</span><span class="op">;</span></span>
<span id="list:java_swagger_interface-4"><a href="#list:java_swagger_interface-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">io</span><span class="op">.</span><span class="im">vertx</span><span class="op">.</span><span class="im">core</span><span class="op">.</span><span class="im">http</span><span class="op">.</span><span class="im">HttpMethod</span><span class="op">;</span></span>
<span id="list:java_swagger_interface-5"><a href="#list:java_swagger_interface-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">io</span><span class="op">.</span><span class="im">vertx</span><span class="op">.</span><span class="im">ext</span><span class="op">.</span><span class="im">web</span><span class="op">.</span><span class="im">RoutingContext</span><span class="op">;</span></span>
<span id="list:java_swagger_interface-6"><a href="#list:java_swagger_interface-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_swagger_interface-7"><a href="#list:java_swagger_interface-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IRouteResponse <span class="op">{</span></span>
<span id="list:java_swagger_interface-8"><a href="#list:java_swagger_interface-8" aria-hidden="true" tabindex="-1"></a>    HttpMethod <span class="fu">getMethod</span><span class="op">();</span></span>
<span id="list:java_swagger_interface-9"><a href="#list:java_swagger_interface-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> <span class="fu">getRoute</span><span class="op">();</span></span>
<span id="list:java_swagger_interface-10"><a href="#list:java_swagger_interface-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Handler</span><span class="op">&lt;</span>RoutingContext<span class="op">&gt;</span> <span class="fu">getHandler</span><span class="op">();</span></span>
<span id="list:java_swagger_interface-11"><a href="#list:java_swagger_interface-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>La parte realmente complicata è stata fare in modo che le annotazioni
presenti nel codice sorgente venissero lette e trasformate in un file
JSON che rappresentasse correttamente la documentazione delle API. Dopo
alcuni tentativi, è stato possibile automatizzare anche questa
operazione.</p>
<div class="sourceCode" id="list:java_swagger_modules"
data-language="Java"
data-caption="Aggiunta dei moduli delle classi contenenti rotte HTTP"
label="list:java_swagger_modules"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:java_swagger_modules-1"><a href="#list:java_swagger_modules-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> ImmutableSet<span class="op">&lt;</span>ClassPath<span class="op">.</span><span class="fu">ClassInfo</span><span class="op">&gt;</span> modelClasses <span class="op">=</span> ImmutableSet<span class="op">.&lt;</span>ClassPath<span class="op">.</span><span class="fu">ClassInfo</span><span class="op">&gt;</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="list:java_swagger_modules-2"><a href="#list:java_swagger_modules-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addAll</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getClassesInPackage</span><span class="op">(</span><span class="st">&quot;game&quot;</span><span class="op">))</span></span>
<span id="list:java_swagger_modules-3"><a href="#list:java_swagger_modules-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addAll</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getClassesInPackage</span><span class="op">(</span><span class="st">&quot;userModule&quot;</span><span class="op">))</span></span>
<span id="list:java_swagger_modules-4"><a href="#list:java_swagger_modules-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addAll</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getClassesInPackage</span><span class="op">(</span><span class="st">&quot;BLManagement&quot;</span><span class="op">))</span></span>
<span id="list:java_swagger_modules-5"><a href="#list:java_swagger_modules-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addAll</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getClassesInPackage</span><span class="op">(</span><span class="st">&quot;chatModule&quot;</span><span class="op">))</span></span>
<span id="list:java_swagger_modules-6"><a href="#list:java_swagger_modules-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span></code></pre></div>
<p>Java permette di creare oggetti molto complessi, diversi dai JSON /
object solitamente utilizzati in JavaScript. Era fondamentale poter
adoperare questi schemi per avere una documentazione ricca e per poter
testare velocemente le API senza utilizzare necessariamente un client
come Postman.</p>
<p>Infine, per poter mostrare correttamente la documentazione, è stato
necessario creare un file HTML che permettesse di visualizzare la
documentazione in modo chiaro e ordinato. Questo file statico, presente
nella repository del progetto, utilizza come fonte il file JSON di
OpenAPI che viene rigenerato a ogni build del progetto, in modo da avere
sempre la documentazione aggiornata.</p>
<h3 id="postman">Postman</h3>
<p>Swagger ha semplificato lo sviluppo delle API e il loro
funzionamento, ma non è sostenibile per testare chiamate API successive
che seguono un certo ordine o che necessitano di payload specifici.
Postman è stato fondamentale per risolvere questo problema.</p>
<p>È stata creata una raccolta di richieste, comodamente esportate da
Swagger senza alcun bisogno di riscrittura. Queste possono contenere
payload parametrizzati grazie alle variabili di ambiente settabili una
volta per tutte, come ad esempio il GameID, che altrimenti, una volta
creato, deve essere copiato e incollato in ogni richiesta successiva che
lo richiede.</p>
<p>L’altro grande vantaggio di utilizzare Postman è stata la
funzionalità Flows, che permette di creare un diagramma di flusso delle
richieste e di salvare alcune risposte in variabili. Fino a quando non
si è arrivati ad avere un frontend funzionante, questi Flows sono stati
utili per trovare eventuali bug e avere ben chiaro il flusso di chiamate
che sarebbero dovute essere implementate nel frontend, il che ha
velocizzato lo sviluppo del frontend, seppur in minima parte.</p>
<p>E’ stato realizzato un flow che simulasse la creazione di una
partita, l’iscrizione di 4 giocatori, l’avvio della partita e la
simulazione di un turno completo di gioco. Questo ha permesso di testare
in modo spedito molte delle funzionalità del sistema, e di trovare
eventuali bug in modo altrettanto rapido.</p>
<p><img src="report/img/postManFlow.png" style="width:18cm;height:10cm"
alt="image" /><br />
</p>
<h3 id="log-automatici">Log automatici</h3>
<p>Il servizio core del sistema è il middleware e per poterlo monitorare
è stato necessario implementare un sistema di log automatici. Tenere
traccia di tutte le operazioni è un compito molto complesso e avrebbe
reso difficile un eventuale debug su un software in produzione che in
caso di errore potrebbe riavviarsi e perdere definitivamente
quell’errore. Grazie a Vertx, che offre "gratuitamente" un logger, e
alla libreria <a
href="https://mvnrepository.com/artifact/ch.qos.logback/logback-classic"><u>LogBack</u></a>,
i log legati alle funzionalità più importanti sono trascritti su file
.log in modo da poterli analizzare in caso di problemi.</p>
<p>Questo sistema poi si è evoluto grazie a una configurazione di
LogBack in un file XML, tramite il quale è possibile personalizzare
completamente il sistema di log, decidendo quali package loggare, in
quali file trascriverli, scegliere il livello di log (info, debug,
error, ecc.) e attuare un sistema di log rotate. Secondo questa
configurazione, i log oltre una certa dimensione vengono compressi e
rinominati per non occupare troppo spazio, e si può anche impostare il
numero di questi file compressi da mantenere.</p>
<div class="sourceCode" id="list:xml_logback" data-language="Xml"
data-caption="File configurazione Log automatici"
label="list:xml_logback"><pre class="sourceCode Xml"><code class="sourceCode xml"><span id="list:xml_logback-1"><a href="#list:xml_logback-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">appender</span><span class="ot"> name=</span><span class="st">&quot;DEBUG_LOG&quot;</span><span class="ot"> class=</span><span class="st">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span>
<span id="list:xml_logback-2"><a href="#list:xml_logback-2" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">file</span>&gt;${DEBUG_FILE}&lt;/<span class="kw">file</span>&gt;</span>
<span id="list:xml_logback-3"><a href="#list:xml_logback-3" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">rollingPolicy</span><span class="ot"> class=</span><span class="st">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span>
<span id="list:xml_logback-4"><a href="#list:xml_logback-4" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">fileNamePattern</span>&gt;${DEBUG_FILE}.%d{yyyy-MM-dd}.%i.gz&lt;/<span class="kw">fileNamePattern</span>&gt;</span>
<span id="list:xml_logback-5"><a href="#list:xml_logback-5" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">maxFileSize</span>&gt;900MB&lt;/<span class="kw">maxFileSize</span>&gt;</span>
<span id="list:xml_logback-6"><a href="#list:xml_logback-6" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">maxHistory</span>&gt;14&lt;/<span class="kw">maxHistory</span>&gt;</span>
<span id="list:xml_logback-7"><a href="#list:xml_logback-7" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">totalSizeCap</span>&gt;2GB&lt;/<span class="kw">totalSizeCap</span>&gt;</span>
<span id="list:xml_logback-8"><a href="#list:xml_logback-8" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">rollingPolicy</span>&gt;</span>
<span id="list:xml_logback-9"><a href="#list:xml_logback-9" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">encoder</span>&gt;</span>
<span id="list:xml_logback-10"><a href="#list:xml_logback-10" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">pattern</span>&gt;${LOG_PATTERN}&lt;/<span class="kw">pattern</span>&gt;</span>
<span id="list:xml_logback-11"><a href="#list:xml_logback-11" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">encoder</span>&gt;</span>
<span id="list:xml_logback-12"><a href="#list:xml_logback-12" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">appender</span>&gt;</span>
<span id="list:xml_logback-13"><a href="#list:xml_logback-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:xml_logback-14"><a href="#list:xml_logback-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:xml_logback-15"><a href="#list:xml_logback-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Il package game usera la configurazione del log di debug --&gt;</span></span>
<span id="list:xml_logback-16"><a href="#list:xml_logback-16" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">logger</span><span class="ot"> level=</span><span class="st">&quot;INFO&quot;</span><span class="ot"> name=</span><span class="st">&quot;game&quot;</span><span class="ot"> additivity=</span><span class="st">&quot;false&quot;</span>&gt;</span>
<span id="list:xml_logback-17"><a href="#list:xml_logback-17" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">appender-ref</span><span class="ot"> ref=</span><span class="st">&quot;DEBUG_LOG_ASYNC&quot;</span>/&gt;</span>
<span id="list:xml_logback-18"><a href="#list:xml_logback-18" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">logger</span>&gt;</span></code></pre></div>
<p>Questo sistema si adatta perfettamente a un software dockerizzabile
che ha montato un volume relativo alla cartella /log, che può anche
essere un volume remoto, da cui è possibile consultare velocemente i log
in caso di problemi.</p>
<div class="sourceCode" id="list:dockerfile_log" data-language="Python"
data-caption="Volume di log nel dockerfile l.13 da montare successivamente"
label="list:dockerfile_log"><pre class="sourceCode python"><code class="sourceCode python"><span id="list:dockerfile_log-1"><a href="#list:dockerfile_log-1" aria-hidden="true" tabindex="-1"></a>FROM gradle:<span class="fl">8.6.0</span><span class="op">-</span>jdk17 AS build</span>
<span id="list:dockerfile_log-2"><a href="#list:dockerfile_log-2" aria-hidden="true" tabindex="-1"></a>COPY <span class="op">--</span>chown<span class="op">=</span>gradle:gradle . <span class="op">/</span>home<span class="op">/</span>gradle<span class="op">/</span>src</span>
<span id="list:dockerfile_log-3"><a href="#list:dockerfile_log-3" aria-hidden="true" tabindex="-1"></a>WORKDIR <span class="op">/</span>home<span class="op">/</span>gradle<span class="op">/</span>src</span>
<span id="list:dockerfile_log-4"><a href="#list:dockerfile_log-4" aria-hidden="true" tabindex="-1"></a>RUN gradle assemble</span>
<span id="list:dockerfile_log-5"><a href="#list:dockerfile_log-5" aria-hidden="true" tabindex="-1"></a>RUN gradle fatJar </span>
<span id="list:dockerfile_log-6"><a href="#list:dockerfile_log-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:dockerfile_log-7"><a href="#list:dockerfile_log-7" aria-hidden="true" tabindex="-1"></a>FROM openjdk:<span class="dv">19</span></span>
<span id="list:dockerfile_log-8"><a href="#list:dockerfile_log-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:dockerfile_log-9"><a href="#list:dockerfile_log-9" aria-hidden="true" tabindex="-1"></a>RUN mkdir <span class="op">/</span>app</span>
<span id="list:dockerfile_log-10"><a href="#list:dockerfile_log-10" aria-hidden="true" tabindex="-1"></a>RUN mkdir <span class="op">/</span>app<span class="op">/</span>log</span>
<span id="list:dockerfile_log-11"><a href="#list:dockerfile_log-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:dockerfile_log-12"><a href="#list:dockerfile_log-12" aria-hidden="true" tabindex="-1"></a>COPY <span class="op">--</span><span class="im">from</span><span class="op">=</span>build <span class="op">/</span>home<span class="op">/</span>gradle<span class="op">/</span>src<span class="op">/</span>app<span class="op">/</span>build<span class="op">/</span>libs<span class="op">/</span> <span class="op">/</span>app<span class="op">/</span></span>
<span id="list:dockerfile_log-13"><a href="#list:dockerfile_log-13" aria-hidden="true" tabindex="-1"></a>COPY <span class="op">--</span><span class="im">from</span><span class="op">=</span>build <span class="op">/</span>home<span class="op">/</span>gradle<span class="op">/</span>src<span class="op">/</span>app<span class="op">/</span>log <span class="op">/</span>app<span class="op">/</span>log</span>
<span id="list:dockerfile_log-14"><a href="#list:dockerfile_log-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:dockerfile_log-15"><a href="#list:dockerfile_log-15" aria-hidden="true" tabindex="-1"></a>EXPOSE <span class="dv">3003</span></span>
<span id="list:dockerfile_log-16"><a href="#list:dockerfile_log-16" aria-hidden="true" tabindex="-1"></a>ENTRYPOINT [<span class="st">&quot;java&quot;</span>,<span class="st">&quot;-jar&quot;</span>,<span class="st">&quot;/app/Middleware.jar&quot;</span>]</span></code></pre></div>
<h2 id="screen">Screen</h2>
<h2 id="optionalmockup">Optional(Mockup)</h2>
<h1 id="ch:DevOps">DevOps</h1>
<h2 id="dvcs">DVCS</h2>
<p>Come strumento di controllo di versione è stato scelto git, sono
state adottate le seguenti best practices o git policy per garantire un
flusso di lavoro coerente e prevenire conflitti di merge.</p>
<h3 id="struttura-dei-branch">Struttura dei Branch</h3>
<p>Una delle componenti principali della Git Policy è la gestione dei
branch. La struttura tipica prevede almeno tre tipi di branch: -
<strong>Master/Main:</strong> Questo è il branch principale che contiene
il codice di produzione. Ogni commit su questo branch dovrebbe essere
stabile e pronto per il rilascio. Questo branch e stato protetto per
evitare commit diretti, richiedendo quindi una revisione per ogni
operazione di merge. - <strong>Develop:</strong> Qui viene integrato il
lavoro di sviluppo corrente. È il branch dove confluiscono le feature
prima di essere preparate per il rilascio. Questo branch dovrebbe essere
costantemente aggiornato e testato per assicurare che sia in uno stato
pronto per la produzione. - <strong>Feature Branches:</strong>
Utilizzati per lo sviluppo di nuove funzionalità. Ogni feature branch
deve derivare da ‘develop‘ e, una volta completata la feature, viene
reintegrato in ‘develop‘ tramite una pull request.</p>
<h3 id="conventional-commits">Conventional commits</h3>
<p>La pratica adottata per i commit è stata quella di effettuare commit
frequenti e significativi.</p>
<p>In ogni repo è stato adottato un sistema standard per scrivere i
commit: i conventional commit. In questo modo i commit risultano più
chiari e facilmente leggibili. Riportiamo di seguito la nomenclatura
usata:</p>
<ul>
<li><p><strong>fix:</strong> per i commit che risolvono un bug</p></li>
<li><p><strong>feat:</strong> per i commit che aggiungono una nuova
feature</p></li>
<li><p><strong>refactor:</strong> per i commit che migliorano il codice
senza aggiungere nuove funzionalità</p></li>
<li><p><strong>docs:</strong> per i commit che riguardano la
documentazione</p></li>
<li><p><strong>style:</strong> per i commit che riguardano la
formattazione del codice</p></li>
<li><p><strong>test:</strong> per i commit che riguardano i
test</p></li>
<li><p><strong>ci:</strong> per i commit che riguardano la Continuous
Integration</p></li>
</ul>
<p>Inoltre sono evidenziati i breaking changes per le modifiche non più
compatibili con le versioni precedenti. La stessa nomenclatura viene
utilizzata anche nel changelog.</p>
<h2 id="issue-template">Issue template</h2>
<p>-per discutere l’impl di una nuova idea, sottomettere feature
proposal, reporting bugs e malfunzionamenti, elaborare nuove impl [il
tip above non l’ho inserito nella relazione di SPE]</p>
<h2 id="continuous-integration">Continuous integration</h2>
<p>-ci (GHA, deploy pages, usato due servizi di hosting github e gitlab
(per copia all’intero di repo di magnani))</p>
<h2 id="build-automation">Build automation</h2>
<h1 id="ch:validazione">Validazione</h1>
<p>test driven development self-assessment/autovalidazione (fai i test
unit e integrazione con jest) Ma noi usiamo Lint e Prettier??? -vuole
che i test della ci siano runnati il più frequentemente possibile (bot
git che li runna?)</p>
<h1 id="ch:deployment">Deployment</h1>
<h2 id="deployment">deployment</h2>
<p>containerizzation</p>
<h1 id="ch:con">Conclusions and Future Work</h1>
<h2 id="conclusions">Conclusions</h2>
<p>Typically a conclusions chapter first summarizes the investigated
problem and its aims and objectives. It summaries the
critical/significant/major findings/results about the aims and
objectives that have been obtained by applying the key
methods/implementations/experiment set-ups. A conclusions chapter draws
a picture/outline of your project’s central and the most signification
contributions and achievements.</p>
<p>A good conclusions summary could be approximately 300–500 words long,
but this is just a recommendation.</p>
<p>A conclusions chapter followed by an abstract is the last things you
write in your project report.</p>
<h2 id="future-work">Future work</h2>
<p>This section should refer to Chapter <a href="#ch:results"
data-reference-type="ref" data-reference="ch:results">[ch:results]</a>
where the author has reflected their criticality about their own
solution. The future work is then sensibly proposed in this section.</p>
<p><strong>Guidance on writing future work:</strong> While working on a
project, you gain experience and learn the potential of your project and
its future works. Discuss the future work of the project in technical
terms. This has to be based on what has not been yet achieved in
comparison to what you had initially planned and what you have learned
from the project. Describe to a reader what future work(s) can be
started from the things you have completed. This includes identifying
what has not been achieved and what could be achieved.</p>
<p>A good future work summary could be approximately 300–500 words long,
but this is just a recommendation.</p>
</body>
</html>
