<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>main</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #ffffff;
        color: #a0a0a0;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b; background-color: #ffffff; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #b08000; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #1f1c1b; } /* Operator */
    code span.ot { color: #006e28; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #0057ae; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="latex2html.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#list-of-abbreviations" id="toc-list-of-abbreviations">List
of Abbreviations</a></li>
<li><a href="#glossario-dei-termini"
id="toc-glossario-dei-termini">Glossario dei termini</a></li>
<li><a href="#ch:into" id="toc-ch:into">Introduzione</a></li>
<li><a href="#ch:analisi" id="toc-ch:analisi">Analisi</a>
<ul>
<li><a href="#obiettivi" id="toc-obiettivi">Obiettivi</a></li>
<li><a href="#politiche-di-autovalutazione"
id="toc-politiche-di-autovalutazione">Politiche di
autovalutazione</a></li>
<li><a href="#requisiti-e-casi-duso"
id="toc-requisiti-e-casi-duso">Requisiti e casi d’uso</a>
<ul>
<li><a href="#requisiti" id="toc-requisiti">Requisiti</a></li>
<li><a href="#casi-duso" id="toc-casi-duso">Casi d’uso</a></li>
</ul></li>
</ul></li>
<li><a href="#ch:architectures" id="toc-ch:architectures">Architettura e
Design</a>
<ul>
<li><a href="#design-generale-del-software"
id="toc-design-generale-del-software">Design generale del
software</a></li>
<li><a href="#micro-servizi-e-la-loro-architettura"
id="toc-micro-servizi-e-la-loro-architettura">Micro-servizi e la loro
architettura</a>
<ul>
<li><a href="#servizio-per-gestione-utenti"
id="toc-servizio-per-gestione-utenti">Servizio per Gestione
Utenti</a></li>
<li><a href="#servizio-business-logic"
id="toc-servizio-business-logic">Servizio Business Logic</a></li>
<li><a href="#servizio-ponte-tra-i-microservizi"
id="toc-servizio-ponte-tra-i-microservizi">Servizio ponte tra i
microservizi</a></li>
</ul></li>
<li><a href="#perche-i-microservizi"
id="toc-perche-i-microservizi">Perche’ i microservizi?</a>
<ul>
<li><a href="#vantaggi-dellarchitettura-a-microservizi"
id="toc-vantaggi-dellarchitettura-a-microservizi">Vantaggi
dell’architettura a microservizi</a></li>
<li><a href="#struttura-api-gateway"
id="toc-struttura-api-gateway">Struttura API Gateway</a></li>
<li><a href="#websockets" id="toc-websockets">WebSockets</a></li>
</ul></li>
</ul></li>
<li><a href="#ch:implementazione"
id="toc-ch:implementazione">Implementazione</a>
<ul>
<li><a href="#componenti" id="toc-componenti">Componenti</a>
<ul>
<li><a href="#business-logic" id="toc-business-logic">Business
Logic</a></li>
<li><a href="#user-service" id="toc-user-service">User Service</a></li>
<li><a href="#front-end" id="toc-front-end">Front-End</a></li>
<li><a href="#middleware" id="toc-middleware">Middleware</a></li>
</ul></li>
<li><a href="#tecnologie" id="toc-tecnologie">Tecnologie</a>
<ul>
<li><a href="#swagger---openapi" id="toc-swagger---openapi">Swagger -
OpenAPI</a></li>
<li><a href="#postman" id="toc-postman">Postman</a></li>
<li><a href="#log-automatici" id="toc-log-automatici">Log
automatici</a></li>
<li><a href="#checkstyle-javadoc-github-page"
id="toc-checkstyle-javadoc-github-page">Checkstyle, javadoc, github page
</a></li>
<li><a href="#lettura-variabili-dambiente"
id="toc-lettura-variabili-dambiente">Lettura variabili
d’ambiente</a></li>
</ul></li>
<li><a href="#riflessioni-sulla-politiche-di-autovalutazione"
id="toc-riflessioni-sulla-politiche-di-autovalutazione">Riflessioni
sulla politiche di autovalutazione</a></li>
<li><a href="#mockup" id="toc-mockup">Mockup</a></li>
<li><a href="#screen" id="toc-screen">Screen</a></li>
</ul></li>
<li><a href="#ch:interazioni" id="toc-ch:interazioni">Interazioni</a>
<ul>
<li><a href="#frontend-leftrightarrow-websocket"
id="toc-frontend-leftrightarrow-websocket">Frontend <span
class="math inline">↔︎</span> WebSocket</a>
<ul>
<li><a href="#chat-globale-e-privata"
id="toc-chat-globale-e-privata">Chat globale e privata</a></li>
<li><a href="#reattività-e-aggiornamento-in-tempo-reale"
id="toc-reattività-e-aggiornamento-in-tempo-reale">Reattività e
aggiornamento in tempo reale</a></li>
</ul></li>
<li><a href="#stack-docker-rightarrow-reti-interne-e-ip-privati"
id="toc-stack-docker-rightarrow-reti-interne-e-ip-privati">Stack Docker
<span class="math inline">→</span> reti interne e IP privati</a>
<ul>
<li><a href="#Nginx" id="toc-Nginx">Nginx</a></li>
</ul></li>
</ul></li>
<li><a href="#ch:DevOps" id="toc-ch:DevOps">DevOps</a>
<ul>
<li><a href="#dvcs" id="toc-dvcs">DVCS</a>
<ul>
<li><a href="#struttura-dei-branch"
id="toc-struttura-dei-branch">Struttura dei Branch</a></li>
<li><a href="#conventional-commits"
id="toc-conventional-commits">Conventional commits</a></li>
</ul></li>
<li><a href="#issue-template" id="toc-issue-template">Issue
template</a></li>
<li><a href="#build-automation" id="toc-build-automation">Build
automation</a>
<ul>
<li><a href="#scheletro-del-workflow"
id="toc-scheletro-del-workflow">Scheletro del workflow</a></li>
<li><a href="#usermanagement-e-businesslogic"
id="toc-usermanagement-e-businesslogic">UserManagement e
BusinessLogic</a></li>
<li><a href="#middleware-1" id="toc-middleware-1">Middleware</a></li>
<li><a href="#frontend" id="toc-frontend">Frontend</a></li>
</ul></li>
<li><a href="#continuous-integration"
id="toc-continuous-integration">Continuous integration</a></li>
</ul></li>
<li><a href="#ch:validazione" id="toc-ch:validazione">Validazione</a>
<ul>
<li><a href="#test" id="toc-test">Test</a>
<ul>
<li><a href="#testing-asincrono" id="toc-testing-asincrono">Testing
asincrono</a></li>
</ul></li>
<li><a href="#code_quality" id="toc-code_quality">Code quality e
linting</a></li>
</ul></li>
<li><a href="#ch:deployment" id="toc-ch:deployment">Deployment</a>
<ul>
<li><a href="#containerization"
id="toc-containerization">Containerization</a>
<ul>
<li><a href="#nodejs" id="toc-nodejs">NodeJS</a></li>
<li><a href="#java" id="toc-java">Java</a></li>
<li><a href="#angular" id="toc-angular">Angular</a></li>
</ul></li>
<li><a href="#monitoraggio" id="toc-monitoraggio">Monitoraggio</a>
<ul>
<li><a href="#grafana" id="toc-grafana">Grafana</a></li>
<li><a href="#prometheus" id="toc-prometheus">Prometheus</a></li>
<li><a href="#cadvisor" id="toc-cadvisor">cAdvisor</a></li>
<li><a href="#integrazione-e-configurazione"
id="toc-integrazione-e-configurazione">Integrazione e
Configurazione</a></li>
</ul></li>
</ul></li>
<li><a href="#ch:con" id="toc-ch:con">Conclusions and Future Work</a>
<ul>
<li><a href="#conclusioni" id="toc-conclusioni">Conclusioni</a></li>
</ul></li>
</ul>
</nav>
<div class="titlepage">
<div class="center">
<p><span>Sistemi distribuiti</span><br />
</p>
<p>Maraffa Online</p>
<p> <br />
<span> Sofia Tosi Matteo Santoro </span><br />
<span> <em>Supervisors:</em> Giovanni Ciatto, Matteo Magnani, Andrea
Omicini </span><br />
</p>
<p>2024-08-24</p>
</div>
</div>
<h2 id="list-of-abbreviations">List of Abbreviations</h2>
<div class="abbrv">
<p>School of Mathematical, Physical and Computational Sciences</p>
<p>Computer Science</p>
<p>GitHub Pages</p>
<p>Continuous Integration</p>
</div>
<h2 id="glossario-dei-termini">Glossario dei termini</h2>
<div class="adjustbox">
<p><span>max width=1.1,center</span></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Nome</th>
<th style="text-align: left;">Descrizione</th>
<th style="text-align: left;">Sinonimi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mano</td>
<td style="text-align: left;">Distribuzione delle 40 carte ai 4
giocatori e la seguente serie di 10 prese</td>
<td style="text-align: left;">Round</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mano</td>
<td style="text-align: left;">Carte dei giocatori non ancora
giocate</td>
<td style="text-align: left;">Hand</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Presa</td>
<td style="text-align: left;">Quando ogni giocatore, a turno, gioca sul
tavolo una carta. L’ultima presa della mano vale 1 punto.</td>
<td style="text-align: left;">Trick</td>
</tr>
<tr class="even">
<td style="text-align: left;">Partita</td>
<td style="text-align: left;">Insieme di più mani fino al raggiungimento
del punteggio di 41 punti.</td>
<td style="text-align: left;">Game</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Partita corta</td>
<td style="text-align: left;">Insieme di più mani fino al raggiungimento
del punteggio di 31 punti.</td>
<td style="text-align: left;">Short Game</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tavolo</td>
<td style="text-align: left;">Raggruppamento di 4 giocatori, suddivisi
in 2 coppie, i giocatori delle stessa squadra “siedono” in direzione
opposta</td>
<td style="text-align: left;">Table</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Seme</td>
<td style="text-align: left;">Tipologia distintiva di carta, ne esistono
4: Denari, Coppe, Spade, Bastoni</td>
<td style="text-align: left;">Suit: Coins, Cups, Swords, Clubs </td>
</tr>
<tr class="even">
<td style="text-align: left;">Briscola</td>
<td style="text-align: left;">Seme con priorita’ piu’ alta.</td>
<td style="text-align: left;">Trump</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maraffa</td>
<td style="text-align: left;">Se un giocatore possiede le tre carte di
valore maggiore (asso, due e tre, dette assieme "Maraffa" o "Cricca")
del seme di briscola, vince tre punti addizionali. In questo caso deve
scendere con l’asso di quel seme.</td>
<td style="text-align: left;">Cricca, Marafon, Tresette con la
Briscola</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mazzo</td>
<td style="text-align: left;">40 carte, di 4 semi diversi,
1,2,3,4,5,6,7, fante, cavallo e re.</td>
<td style="text-align: left;">Deck</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Taglio</td>
<td style="text-align: left;">Durante una mano in un seme viene giocato
il seme di briscola, che avendo priorita’ maggiore permette di prendere
nonostante il seme di gioco</td>
<td style="text-align: left;">Cut</td>
</tr>
<tr class="even">
<td style="text-align: left;">Busso</td>
<td style="text-align: left;">Invita il compagno, se possibile, a
conquistare la presa e ad aprire il turno successivo con lo stesso
seme</td>
<td style="text-align: left;">Knock</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Striscio corto</td>
<td style="text-align: left;">Quando si ha ancora in mano un basso
numero di carte dello stesso seme con cui si è aperto il turno.</td>
<td style="text-align: left;">Short strip</td>
</tr>
<tr class="even">
<td style="text-align: left;">Striscio lungo</td>
<td style="text-align: left;">Quando si ha ancora in mano molte carte
dello stesso seme con cui si è aperto il turno.</td>
<td style="text-align: left;">Long strip</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Volo</td>
<td style="text-align: left;">Quando non si hanno più carte del seme con
cui si è aperto il turno.</td>
<td style="text-align: left;">Fly</td>
</tr>
<tr class="even">
<td style="text-align: left;">Figura</td>
<td style="text-align: left;">Fante, Cavallo, Re, con punteggio di 1/3
di punto.</td>
<td style="text-align: left;">Figure</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asso</td>
<td style="text-align: left;">Carta con valore di 1 punto.</td>
<td style="text-align: left;">Ace</td>
</tr>
<tr class="even">
<td style="text-align: left;">Due e Tre</td>
<td style="text-align: left;">Carte con valore 1/3 di punto.</td>
<td style="text-align: left;">Two and Three</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Carta Liscia</td>
<td style="text-align: left;">Carte con numeri 4, 5, 6, 7. Sono prive di
valore</td>
<td style="text-align: left;">Smooth paper</td>
</tr>
<tr class="even">
<td style="text-align: left;">Squadra</td>
<td style="text-align: left;">Coppie di giocatori seduti opposti</td>
<td style="text-align: left;">Team</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Giocatore</td>
<td style="text-align: left;">Persona che interagisce con
l’applicativo</td>
<td style="text-align: left;">Player, User</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chiamata fuori</td>
<td style="text-align: left;">Se un giocatore pensa che la sua squadra
abbia raggiunto i 41 punti (o 31 punti nella variante "corta" della
partita), la squadra può dichiarare di avere già nel mazzo delle prese i
punti per vincere e chiudere in anticipo l’ultima partita. In questo
modo la mano termina immediatamente, senza che vengano giocate le
restanti prese e la squadra che si è "chiamata fuori" impedisce
all’altra squadra di conquistare ulteriori prese. Se una squadra si
chiama fuori e, dopo aver contato i punti delle prese effettuate ed
averli sommati ai punti ottenuti nelle mani già giocate, non raggiunge i
punti per la vittoria (in gergo "sbaglia la chiamata") scatta automatico
l’11 a 0 per la squadra avversaria</td>
<td style="text-align: left;">Call out</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Modalità di gioco</td>
<td style="text-align: left;">regole di gioco classiche o varianti che
influenzano aspetti come il punteggio, condizioni di vittoria/perdita,
... Ne sono state implementate due: classica, 11 a 0.</td>
<td style="text-align: left;">Game mode</td>
</tr>
</tbody>
</table>
</div>
<h1 id="ch:into">Introduzione</h1>
<p>MaraffaOnline è un’applicazione che permette alle persone di giocare
al gioco di carte <a
href="https://it.wikipedia.org/wiki/Marafone_Beccacino">Maraffa/Beccacino</a>.
Il progetto consiste nell’eseguire una manutenzione evolutiva del gioco
di carte reperibile su MaraffaOnline, attualmente sviluppato dalla
prof.ssa Lumini. In particolare la nuova versione avrà un’architettura a
microservizi e introdurrà anche nuove funzionalità come formazione
personalizzata delle squadre, una nuova modalità di gioco (vittoria 11 a
0 in caso di violazione delle regole da parte di una squadra),
salvataggio delle statistiche delle partite e degli utenti, ...<br />
Per realizzare questa evoluzione, il progetto sarà suddiviso in diverse
fasi, ognuna delle quali si concentrerà su un aspetto specifico
dell’architettura e delle funzionalità.</p>
<p>La prima fase riguarderà la decomposizione dell’applicazione
monolitica esistente in microservizi indipendenti, che comunicheranno
tra loro attraverso API RESTful.</p>
<p>Nella seconda fase, saranno sviluppati i sistemi di salvataggio delle
statistiche e la chat. Le statistiche di gioco saranno memorizzate in un
database relazionale, permettendo agli utenti di visualizzare le loro
performance nel tempo e confrontarsi con altri giocatori. Il gioco
disporrà di due chat: una globale, accessibile a tutti gli utenti, e una
relativa alla partita, accessibile solo ai giocatori della partita in
corso.</p>
<p>La terza fase si concentrerà sull’implementazione delle nuove
funzionalità, partendo dalla formazione personalizzata delle squadre
fino alla modalità 11 a 0, la quale assicurerà che le violazioni delle
regole siano rilevate automaticamente.</p>
<p>Il progetto sarà gestito utilizzando metodologie agili, con sprint di
sviluppo e feedback continuo da parte degli utenti. In questo modo, sarà
possibile adattare rapidamente il piano di lavoro in base ai consigli,
garantendo al contempo un prodotto finale di alta qualità e in linea con
le aspettative degli utenti.</p>
<h1 id="ch:analisi">Analisi</h1>
<h2 id="obiettivi">Obiettivi</h2>
<p>I principali requisiti funzionali e obiettivi del sistema sono:</p>
<ul>
<li><p><strong>Costruzione di un’architettura a
micro-servizi</strong>.</p></li>
<li><p><strong>Autenticazione e registrazione utenti:</strong>
possibilità di accedere ad un’area privata per poter visualizzare
informazioni personali, oltre alla possibilità di poter giocare senza un
proprio account in modalità ’ospite’.</p></li>
<li><p><strong>Creazione e gestione partita:</strong> gli utenti possono
creare o partecipare ad una partita che inizierà soltanto quando 4
giocatori saranno presenti e disposti in due squadre da 2.</p></li>
<li><p><strong>Chat di gioco:</strong> possibilità di scambiare
messaggi.</p></li>
<li><p><strong>Nuova modalità di gioco</strong> in cui se si commette un
errore di gioco la partita viene conclusa conferendo alla squadra
avversaria il massimo dei punti.</p></li>
<li><p><strong>Persistenza dei dati:</strong> salvataggio su database
degli utenti e delle statistiche delle partite (mani giocate, briscola,
etc...).</p></li>
</ul>
<h2 id="politiche-di-autovalutazione">Politiche di autovalutazione</h2>
<p>Di seguito vengono riportati i casi che dovranno essere gestiti dal
sistema:</p>
<ul>
<li><p>l’elenco delle partite iniziate/finite deve rimanere
aggiornato</p></li>
<li><p>se un giocatore si disconnette la partita termina per
tutti</p></li>
<li><p>connessione lenta o malfunzionamenti da parte di un
giocatore</p></li>
<li><p>un giocatore clicca sul tasto "esci"</p></li>
<li><p>nel caso di un crash di un servizio si deve garantire che il
servizio venga riavviato in automatico evitando che il sistema si
blocchi</p></li>
</ul>
<h2 id="requisiti-e-casi-duso">Requisiti e casi d’uso</h2>
<h3 id="requisiti">Requisiti</h3>
<ol>
<li><p>Account</p>
<ol>
<li><p>Login</p></li>
<li><p>Registrazione</p></li>
<li><p>Recupero password</p></li>
<li><p>Visualizzazione profilo</p></li>
<li><p>Modifica password</p></li>
<li><p>Possibilità di scegliere se giocare come ospite o effettuare il
login</p></li>
</ol></li>
<li><p>Realizzazione partita</p>
<ol>
<li><p>Creazione partita</p></li>
<li><p>Partecipazione partita</p></li>
<li><p>gioca carta</p></li>
<li><p>Inizio partita</p></li>
<li><p>Fine mano</p></li>
<li><p>Fine partita</p></li>
</ol></li>
<li><p>Chat di gioco</p>
<ol>
<li><p>chat globale</p></li>
<li><p>chat partita</p></li>
</ol></li>
<li><p>Possibilità di scegliere un compagno di squadra</p></li>
<li><p>Scelta del seme, parole consentite</p></li>
<li><p>Modalità di gioco 11 a 0</p></li>
<li><p>Gestione punteggio</p>
<ol>
<li><p>Calcolo totale e parziale (Gestione per ogni mano) del
punteggio</p></li>
<li><p>Maraffa/Cricca (+3 punti)</p></li>
</ol></li>
<li><p>Servizio gestione utenti</p></li>
<li><p>Salvataggio statistiche</p></li>
<li><p>Realizzazione GUI</p>
<ol>
<li><p>Refactor della GUI esistente</p></li>
<li><p>Rinnovamento GUI</p></li>
</ol></li>
</ol>
<h3 id="casi-duso">Casi d’uso</h3>
<p>Si riporta di seguito lo schema dei casi d’uso che modella
l’interazione dell’utente con l’applicazione.</p>
<figure id="use_case">
<img src="report/img/Casi_duso.png" />
<figcaption>Casi d’uso</figcaption>
</figure>
<h1 id="ch:architectures">Architettura e Design</h1>
<h2 id="design-generale-del-software">Design generale del software</h2>
<p>L’architettura del software è basata su micro-servizi autonomi e
indipendenti tra loro e la loro comunicazione avviene tramite API REST.
Esiste un middleware che si occupa della gestione e dell’orchestrazione
dei micro-servizi, facendo appunto da ponte collegando le varie diverse
tencologie.</p>
<p>I microservizi che si sono scelti di sviluppare si occupano di varie
aree legate alla natura del progetto e sono:</p>
<ul>
<li><p><strong>UserService</strong>: si occupa della gestione degli
utenti, quindi la loro registrazione, autenticazione e gestione dei dati
personali.</p></li>
<li><p><strong>BusinessLogic</strong>: si occupa di mantenere al proprio
interno tutte le regole proprie del gioco</p></li>
<li><p><strong>Front-End</strong>: si occupa di gestire l’interfaccia
grafica e la comunicazione con il middleware.</p></li>
<li><p><strong>Middleware</strong>: si occupa della gestione delle
comunicazioni tra i vari microservizi, e svolge la funzione di "motore
di gioco".</p></li>
</ul>
<p><img src="report/img/Architecture.png" style="width:12cm"
alt="image" /><br />
</p>
<h2 id="micro-servizi-e-la-loro-architettura">Micro-servizi e la loro
architettura</h2>
<h3 id="servizio-per-gestione-utenti">Servizio per Gestione Utenti</h3>
<div id="tab:user_serv_table">
<table>
<caption>Tabella descrittiva User Service</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Linguaggio</td>
<td style="text-align: left;">Node.JS/TypeScript</td>
</tr>
<tr class="even">
<td style="text-align: left;">Framework</td>
<td style="text-align: left;">NestJS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Persistence</td>
<td style="text-align: left;">Mysql</td>
</tr>
<tr class="even">
<td style="text-align: left;">Librerie</td>
<td style="text-align: left;">TypeORM</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Architettura</td>
<td style="text-align: left;">Model-Controller-service</td>
</tr>
</tbody>
</table>
</div>
<h3 id="servizio-business-logic">Servizio Business Logic</h3>
<div id="tab:bl_serv_table">
<table>
<caption>Tabella descrittiva Business Logic</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Linguaggio</td>
<td style="text-align: left;">Node.JS/TypeScript</td>
</tr>
<tr class="even">
<td style="text-align: left;">Framework</td>
<td style="text-align: left;">NestJS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Architettura</td>
<td style="text-align: left;">Model-Controller-service</td>
</tr>
</tbody>
</table>
</div>
<h3 id="servizio-ponte-tra-i-microservizi">Servizio ponte tra i
microservizi</h3>
<div id="tab:middleware_serv_table">
<table>
<caption>Tabella descrittiva Middleware</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Linguaggio</td>
<td style="text-align: left;">Java</td>
</tr>
<tr class="even">
<td style="text-align: left;">Server</td>
<td style="text-align: left;">Vertx</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Librerie</td>
<td style="text-align: left;">RabbitMQ(vertx)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Architettura</td>
<td style="text-align: left;">Multi-agent, motore di gioco</td>
</tr>
</tbody>
</table>
</div>
<h2 id="perche-i-microservizi">Perche’ i microservizi?</h2>
<p>Ogni microservizio si occupa di gestire un singolo ambito di
progetto, il che fa sì che si ottengano ottimi risultati riguardo la
qualità e l’affidabilità, la riutilizzabilità, la flessibilità e la
scalabilità. Tutti i componenti sono "loosely coupled", distribuiti in
modo indipendente, altamente collaudabili e gestibili e in ambiti reali
gestiti da un piccolo team. Tuttavia, non si tratta di una soluzione
definitiva, ha anche degli svantaggi come ad esempio:</p>
<ul>
<li><p>la complessità di gestione e la necessità di un’infrastruttura di
rete molto complessa.</p></li>
<li><p>un’ottima comunicazione di team.</p></li>
<li><p>una discreta capacità di astrazione e progettazione di
interfaccie di comunicazione che devono essere rispettate da tutti i
microservizi.</p></li>
<li><p>Non si ha la certezza che l’infrastruttura funzioni correttamente
fino a quando tutti i servizi non cooperano tra loro.</p></li>
</ul>
<h3 id="vantaggi-dellarchitettura-a-microservizi">Vantaggi
dell’architettura a microservizi</h3>
<h4 id="fault-tolerance">Fault Tolerance</h4>
<p>Progettare un sistema completamente privo di errori è un obiettivo
decisamente ambizioso e molto difficile da raggiungere. Molto più
realistico, e inerente al nostro percorso, è progettare un sistema che
sia in grado di tollerare, nella giusta misura, gli errori che
inevitabilmente si verificheranno. La scelta di questa architettura tra
i vari vantaggi offre la possibilità di <strong>isolare parti del
sistema</strong>, evitando che gli errori si propaghino in modo
incontrollato e che il sistema nel suo complesso vada in crash. Ogni
sistema opera in modo indipendente e autonomo, con le proprie risorse e
la propria logica.</p>
<p>Lo snodo centrale di comunicazione dei servizi, il middleware, è in
grado di gestire le comunicazioni tra i vari microservizi e di garantire
che il sistema sia in grado di funzionare anche in caso di guasti.
Purtroppo non esiste alcun progetto senza alcun tipo di <strong>single
point of failure</strong>, o almeno non con le risorse a disposizione di
noi studenti, quindi all’interno di questo servizio la gestione degli
errori dei servizi con cui comunica è gestita, ma di fatto, nel caso in
cui il middleware smetta di funzionare, non avendo nessun altro servizio
che possa fare da garante per il suo corretto funzionamento, tutto il
sistema non permetterà, ad esempio, di giocare a nessun gioco. Questo
perché il middleware è il cuore pulsante del sistema; avendo
disponibilità di risorse e abbastanza conoscenze in un ambito reale,
questo problema ha soluzioni:</p>
<ul>
<li><p><strong>Backup del middleware</strong>: avere dei backup dei
processi che si occupano di gestire le partite, ma questo
significherebbe andare a modificare inevitabilmente la struttura già
esistente del servizio.</p></li>
<li><p><strong>Ridondanza del middleware</strong>: avere molteplici
istanze del middleware, preferibilmente 3, di cui una principale e le
altre 2 in copia, facendo in modo che ogni azione sul middleware
principale venga replicata sulle altre due istanze e che quindi, in caso
di guasto hardware, le altre copie possano rispondere alle richieste. Se
si utilizza questa soluzione bisogna prestare attenzione alla
consistenza delle copie. La non consistenza potrebbe addirittura
peggiorare la situazione. Per questo motivo è consigliato averne più di
una, in modo tale da controllarne la consistenza.</p></li>
</ul>
<h4 id="scalabilità">Scalabilità</h4>
<p>Nel caso del middleware, la scalabilità è un altro modo per chiamare
la duplicazione, ma questo si applica soltanto al middleware, in quanto
gli altri microservizi sono realmente scalabili. Ogni microservizio è in
grado di scalare in modo indipendente, in base alle proprie esigenze, e
questo permette di avere un sistema che si adatta in modo dinamico alle
richieste degli utenti. Nella prossima sezione verrà approfondito come
il deployment con Docker permetta di scalare i microservizi.
L’implementazione di un sistema di load balancing viene fornita
"gratuitamente" da Kubernetes, che permette di bilanciare il carico tra
i vari nodi del cluster. Qualora il progetto maraffa-online dovesse
avere un numero di utenti molto elevato, si potrebbe pensare di scalare
il sistema in modo orizzontale, aggiungendo nuovi nodi al cluster, e
tramite la dovuta configurazione, Kubernetes si occuperebbe di
bilanciare il carico tra i vari nodi dei servizi scalabili.</p>
<h4 id="docker">Docker</h4>
<p>Suddividere un progetto monolitico in servizi a sé stanti permette di
dockerizzare comodamente ogni servizio e questo consente di avere un
sistema facilmente deployabile, versionabile e portabile. Uno dei
requisiti fondamentali del progetto era riuscire a dockerizzare
interamente il sistema. Nel caso in cui si volesse fare un deploy su un
server remoto, sarebbe sufficiente avere Docker installato, accedere al
docker-compose del progetto, settare le corrette variabili d’ambiente e
poi il progetto opererebbe in totale autonomia. Inoltre, utilizzare uno
stack permette anche di gestire eventuali failure dei servizi in modo
più semplice, poiché Docker consente di avere un sistema fault-tolerant.
Se un servizio dovesse andare in crash per qualche motivo inspiegabile,
Docker si occuperebbe di riavviarlo in modo autonomo. L’utilizzo di uno
stack permette anche di scalare i servizi in modo più semplice, poiché
basta settare il numero di repliche desiderate per un servizio e Docker
si occuperà di creare le repliche e di bilanciare il carico tra di esse.
Questo è un vantaggio nel caso in cui si voglia scalare il sistema in
modo orizzontale, ovvero aumentando le instanze di un singolo
servizio.</p>
<h3 id="struttura-api-gateway">Struttura API Gateway</h3>
<p>Il pattern di progettazione utilizzato per la realizzazione del
middleware è quello dell’API Gateway, che permette di creare
un’interfaccia unica per l’accesso ai vari servizi del sistema.</p>
<p>Nel nostro progetto, il client effettua semplici chiamate verso il
middleware, che nei casi necessari effettua chiamate verso altri servizi
per svolgere una determinata operazione. Queste chiamate non sono
obbligatoriamente dirette verso il servizio interessato, ma possono
anche essere routine che effettuano molteplici chiamate per ottenere il
risultato desiderato. Implementare queste chiamate direttamente nel
front-end avrebbe reso il codice molto più complesso e difficile da
mantenere, e la gestione di partite multiple sarebbe stata molto più
difficile.</p>
<p>Non è stato implementato nessun meccanismo di discovery per la
gestione di chiamate verso gli altri servizi, in quanto tutti presenti
sullo stesso server e nello stesso stack di Docker, quindi facilmente
individuabili sulla rete virtuale creata da Docker.</p>
<p>Si è seguito un approccio modulare nello sviluppo di questo
componente che, in un primo step, conteneva soltanto la logica di
gestione delle partite, al quale sono stati aggiunti i moduli per la
comunicazione con il servizio degli utenti e della business logic. Ogni
modulo segue la stessa struttura, ossia una classe denominata controller
che si occupa esclusivamente della dichiarazione delle rotte HTTP e che
a sua volta contiene un service. Ogni servizio contiene poi le logiche
di calcolo e crea un JSON di risposta che viene passato al controller
che lo invia come risposta HTTP, questo per poter separare completamente
e rispettare il principio di single responsibility.</p>
<p>Nel modulo contenente le logiche di gioco è stato necessario
aggiungere un ulteriore strato alla struttura controller-service, data
la struttura multi-agente della gestione delle partite che non
permetteva una separazione netta. Quindi è stato aggiunto, tra il
controller e il service, un componente ibrido per poter comunque avere
servizi indipendenti.</p>
<p>Questa separazione, oltre a essere una buona pratica, è stata scelta
per poter effettuare del testing comodamente soltanto sui servizi,
testando quindi solamente la parte relativa all’elaborazione di una
risposta.</p>
<h3 id="websockets">WebSockets</h3>
<p>L’interazione con il frontend avviene prevalentemente tramite il
protocollo HTTP, ma per la gestione di alcuni aspetti in tempo reale
sono state introdotte le WebSocket. Questo componente è stato creato, ad
esempio, per la gestione delle chat di gioco, in modo che i giocatori
possano comunicare tra loro in tempo reale. Ogni client, istanziato sul
computer degli utenti, effettua una connessione WebSocket con il
middleware utilizzando come endpoint il proprio UUID, che viene
assegnato automaticamente all’avvio, e lo username del giocatore, dopo
aver effettuato il login. Il middleware contiene al proprio interno una
mappa di tutti i client e giocatori connessi con la relativa WebSocket e
una classe che espone due metodi per inviare messaggi a un singolo
giocatore o effettuare un messaggio broadcast a tutti i giocatori
connessi.</p>
<p>Il modulo di game si occupa di gestire le partite, quindi è l’unico
che può sapere quali giocatori devono ricevere determinati messaggi
relativi a una singola partita. Per utilizzare il servizio di WebSocket,
è stata implementata una semplice interfaccia all’interno dell’agente di
gioco con la quale si effettuano chiamate "onEvent". Ogni volta che un
particolare evento si verifica, un’invocazione a queste chiamate
permette di inviare messaggi alle WebSocket dei giocatori
interessati.</p>
<div class="sourceCode" id="list:java_websocket_interface"
data-language="Java"
data-caption="Interfaccia per gestire chiamate websocket"
label="list:java_websocket_interface"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:java_websocket_interface-1"><a href="#list:java_websocket_interface-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> game</span><span class="op">;</span></span>
<span id="list:java_websocket_interface-2"><a href="#list:java_websocket_interface-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-3"><a href="#list:java_websocket_interface-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">game</span><span class="op">.</span><span class="im">service</span><span class="op">.</span><span class="im">User</span><span class="op">;</span></span>
<span id="list:java_websocket_interface-4"><a href="#list:java_websocket_interface-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-5"><a href="#list:java_websocket_interface-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IGameAgent <span class="op">{</span></span>
<span id="list:java_websocket_interface-6"><a href="#list:java_websocket_interface-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-7"><a href="#list:java_websocket_interface-7" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onCreateGame</span><span class="op">(</span>User user<span class="op">);</span></span>
<span id="list:java_websocket_interface-8"><a href="#list:java_websocket_interface-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-9"><a href="#list:java_websocket_interface-9" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onNewRound</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-10"><a href="#list:java_websocket_interface-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-11"><a href="#list:java_websocket_interface-11" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onJoinGame</span><span class="op">(</span>User user<span class="op">);</span></span>
<span id="list:java_websocket_interface-12"><a href="#list:java_websocket_interface-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-13"><a href="#list:java_websocket_interface-13" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onStartGame</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-14"><a href="#list:java_websocket_interface-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-15"><a href="#list:java_websocket_interface-15" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onCheckMaraffa</span><span class="op">(</span><span class="dt">int</span> suit<span class="op">,</span> <span class="bu">String</span> username<span class="op">);</span></span>
<span id="list:java_websocket_interface-16"><a href="#list:java_websocket_interface-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-17"><a href="#list:java_websocket_interface-17" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onPlayCard</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-18"><a href="#list:java_websocket_interface-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-19"><a href="#list:java_websocket_interface-19" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onTrickCompleted</span><span class="op">(</span>Trick latestTrick<span class="op">);</span></span>
<span id="list:java_websocket_interface-20"><a href="#list:java_websocket_interface-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-21"><a href="#list:java_websocket_interface-21" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onMessage</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-22"><a href="#list:java_websocket_interface-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-23"><a href="#list:java_websocket_interface-23" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onEndRound</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-24"><a href="#list:java_websocket_interface-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-25"><a href="#list:java_websocket_interface-25" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onEndGame</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-26"><a href="#list:java_websocket_interface-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-27"><a href="#list:java_websocket_interface-27" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onNewGame</span><span class="op">(</span><span class="bu">String</span> newGameID<span class="op">);</span></span>
<span id="list:java_websocket_interface-28"><a href="#list:java_websocket_interface-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-29"><a href="#list:java_websocket_interface-29" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onChangeTeam</span><span class="op">();</span></span>
<span id="list:java_websocket_interface-30"><a href="#list:java_websocket_interface-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_websocket_interface-31"><a href="#list:java_websocket_interface-31" aria-hidden="true" tabindex="-1"></a>	<span class="dt">void</span> <span class="fu">onMakeCall</span><span class="op">(</span><span class="dt">final</span> Call call<span class="op">);</span></span>
<span id="list:java_websocket_interface-32"><a href="#list:java_websocket_interface-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="ch:implementazione">Implementazione</h1>
<h2 id="componenti">Componenti</h2>
<p>Entrambi questi servizi sono stati realizzati con lo stack NestJS, un
framework per Node.js che semplifica la realizzazione di web server e
API REST. Si occupano rispettivamente di gestire la logica di gioco e la
gestione degli utenti che vogliono utilizzare il sistema, due core
business del progetto.</p>
<h3 id="business-logic">Business Logic</h3>
<p>Questo servizio mantiene al proprio interno tutte le regole del gioco
e il calcolo dei punteggi. Ha svariati endpoint che permettono al
middleware di avere il minor numero possibile di responsabilità,
delegando al servizio di business logic le operazioni riguardanti il
gioco.</p>
<p>Questa scelta è stata fatta per mantenere il middleware il più
leggero possibile e per evitare che si occupi di operazioni non di sua
competenza. Inoltre, in futuro sarà possibile aggiungere nuovi giochi
modificando il meno possibile il middleware, che dovrà semplicemente
occuparsi della gestione delle partite e comunicare tempestivamente con
i servizi di business logic in base al gioco scelto.</p>
<h3 id="user-service">User Service</h3>
<p>Questo servizio gestisce gli utenti, quindi la loro registrazione,
autenticazione e gestione dei dati personali. Anche in questo caso, il
middleware delega al servizio di gestione degli utenti le operazioni
riguardanti gli utenti, per mantenere il middleware il più leggero
possibile e per evitare che si occupi di operazioni non di sua
competenza. Il core di questo servizio è dato dalla combinazione di
NestJS e TypeORM, che permettono di gestire in modo semplice e veloce la
persistenza dei dati e le operazioni CRUD su un database MySQL. Oltre
alle informazioni degli utenti, il database contiene anche le
informazioni riguardanti le partite giocate e le statistiche personali
di ogni utente del sistema.</p>
<h3 id="front-end">Front-End</h3>
<p>Il front-end è stato realizzato con Angular e si occupa di gestire
l’interfaccia grafica e la comunicazione con il middleware. Il progetto
pilota di questo frontend è un template di una generica app in angular,
questo velocizzato in parte fornendo una struttura e alcune best
practice di angular di cui non si era a conoscenza. Sono state
realizzate diverse pagine, tra cui la home page, la pagina di
registrazione, la pagina di login, la pagina di gioco e la pagina di
profilo utente. Utilizza API REST per comunicare con il middleware e
ottenere i dati necessari per il funzionamento del gioco, mentre
utilizza WebSockets per la comunicazione in tempo reale con il
middleware.</p>
<h3 id="middleware">Middleware</h3>
<p><img src="report/img/middleware.png" style="width:12cm"
alt="image" /><br />
Come già citato, il middleware è il cuore del sistema. L’architettura
utilizzata per la gestione delle partite è quella di un multi-agente, in
cui ogni agente si occupa di gestire una partita e di orchestrare la
comunicazione con gli altri servizi, come ad esempio il front-end.
Questo core è stato realizzato con Vertx, che è stato utilizzato anche
per creare un web-server in Java.</p>
<p>Inoltre, al middleware è collegato un database NoSQL su MongoDB, che
viene aggiornato a ogni trick completato dai giocatori per creare uno
storico delle partite e salvare le loro decisioni in gioco. Questa
raccolta di dati sarà parte di uno sviluppo futuro, in cui, dopo aver
raccolto una grande quantità di dati di partite, si potrà tentare di
creare un modello di machine learning per sviluppare un’intelligenza
artificiale che possa giocare al posto di un giocatore umano.</p>
<h2 id="tecnologie">Tecnologie</h2>
<h3 id="swagger---openapi">Swagger - OpenAPI</h3>
<p>Uno dei requisiti fondamentali di questo progetto è stata la
documentazione delle API. Per fare ciò è stato utilizzato Swagger, un
framework open-source che permette di descrivere, produrre e consumare
servizi web RESTful. Swagger permette di testare le API direttamente
dalla documentazione, grazie a un’interfaccia grafica che consente di
inviare richieste e visualizzare le risposte.</p>
<p>Per i servizi creati in Node.js è stata utilizzata una libreria ad
hoc, in grado di generare la documentazione automaticamente tramite i
corretti decoratori. Al contrario, per i servizi in Java non esiste
alcuna libreria in grado di generare automaticamente la documentazione
API a partire dai metodi esposti, quindi è stata creata manualmente.
Grazie a un lavoro preliminare open-source svolto da <a
href="https://github.com/anupsaund"><u>Anup Saund</u></a> sulla sua
repository <a
href="https://github.com/anupsaund/vertx-auto-swagger"><u>Vertx auto
swagger</u></a>, è stato possibile creare automaticamente un file HTML
contenente la documentazione delle API esposte dai servizi in Java.
Purtroppo, questo file non era in grado di aggiornarsi automaticamente
in caso di modifiche alle rotte, quindi è stato necessario adattarlo per
renderlo più flessibile e adatto al nostro progetto.</p>
<p>Vertx è una libreria davvero completa e ben strutturata. È stato
possibile creare un Router in grado di gestire tutte le rotte del
progetto in Java utilizzando una semplice classe astratta che ha
definito tutti i metodi utilizzati nel progetto, tramite la quale si è
potuto razionalizzare il codice e creare dinamicamente la funzionalità
richiesta.</p>
<div class="sourceCode" id="list:java_swagger_interface"
data-language="Java"
data-caption="Semplice interfaccia per le rotte HTTP"
label="list:java_swagger_interface"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:java_swagger_interface-1"><a href="#list:java_swagger_interface-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> httpRest</span><span class="op">;</span></span>
<span id="list:java_swagger_interface-2"><a href="#list:java_swagger_interface-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_swagger_interface-3"><a href="#list:java_swagger_interface-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">io</span><span class="op">.</span><span class="im">vertx</span><span class="op">.</span><span class="im">core</span><span class="op">.</span><span class="im">Handler</span><span class="op">;</span></span>
<span id="list:java_swagger_interface-4"><a href="#list:java_swagger_interface-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">io</span><span class="op">.</span><span class="im">vertx</span><span class="op">.</span><span class="im">core</span><span class="op">.</span><span class="im">http</span><span class="op">.</span><span class="im">HttpMethod</span><span class="op">;</span></span>
<span id="list:java_swagger_interface-5"><a href="#list:java_swagger_interface-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">io</span><span class="op">.</span><span class="im">vertx</span><span class="op">.</span><span class="im">ext</span><span class="op">.</span><span class="im">web</span><span class="op">.</span><span class="im">RoutingContext</span><span class="op">;</span></span>
<span id="list:java_swagger_interface-6"><a href="#list:java_swagger_interface-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:java_swagger_interface-7"><a href="#list:java_swagger_interface-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IRouteResponse <span class="op">{</span></span>
<span id="list:java_swagger_interface-8"><a href="#list:java_swagger_interface-8" aria-hidden="true" tabindex="-1"></a>    HttpMethod <span class="fu">getMethod</span><span class="op">();</span></span>
<span id="list:java_swagger_interface-9"><a href="#list:java_swagger_interface-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> <span class="fu">getRoute</span><span class="op">();</span></span>
<span id="list:java_swagger_interface-10"><a href="#list:java_swagger_interface-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Handler</span><span class="op">&lt;</span>RoutingContext<span class="op">&gt;</span> <span class="fu">getHandler</span><span class="op">();</span></span>
<span id="list:java_swagger_interface-11"><a href="#list:java_swagger_interface-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>La parte realmente complicata è stata fare in modo che le annotazioni
presenti nel codice sorgente venissero lette e trasformate in un file
JSON che rappresentasse correttamente la documentazione delle API. Dopo
alcuni tentativi, è stato possibile automatizzare anche questa
operazione.</p>
<div class="sourceCode" id="list:java_swagger_modules"
data-language="Java"
data-caption="Aggiunta dei moduli delle classi contenenti rotte HTTP"
label="list:java_swagger_modules"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:java_swagger_modules-1"><a href="#list:java_swagger_modules-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> ImmutableSet<span class="op">&lt;</span>ClassPath<span class="op">.</span><span class="fu">ClassInfo</span><span class="op">&gt;</span> modelClasses <span class="op">=</span> ImmutableSet<span class="op">.&lt;</span>ClassPath<span class="op">.</span><span class="fu">ClassInfo</span><span class="op">&gt;</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="list:java_swagger_modules-2"><a href="#list:java_swagger_modules-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addAll</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getClassesInPackage</span><span class="op">(</span><span class="st">&quot;game&quot;</span><span class="op">))</span></span>
<span id="list:java_swagger_modules-3"><a href="#list:java_swagger_modules-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addAll</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getClassesInPackage</span><span class="op">(</span><span class="st">&quot;userModule&quot;</span><span class="op">))</span></span>
<span id="list:java_swagger_modules-4"><a href="#list:java_swagger_modules-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addAll</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getClassesInPackage</span><span class="op">(</span><span class="st">&quot;BLManagement&quot;</span><span class="op">))</span></span>
<span id="list:java_swagger_modules-5"><a href="#list:java_swagger_modules-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addAll</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">getClassesInPackage</span><span class="op">(</span><span class="st">&quot;chatModule&quot;</span><span class="op">))</span></span>
<span id="list:java_swagger_modules-6"><a href="#list:java_swagger_modules-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span></code></pre></div>
<p>Java permette di creare oggetti molto complessi, diversi dai JSON /
object solitamente utilizzati in JavaScript. Era fondamentale poter
adoperare questi schemi per avere una documentazione ricca e per poter
testare velocemente le API senza utilizzare necessariamente un client
come Postman.</p>
<p>Infine, per poter mostrare correttamente la documentazione, è stato
necessario creare un file HTML che permettesse di visualizzare la
documentazione in modo chiaro e ordinato. Questo file statico, presente
nella repository del progetto, utilizza come fonte il file JSON di
OpenAPI che viene rigenerato a ogni build del progetto, in modo da avere
sempre la documentazione aggiornata.</p>
<h3 id="postman">Postman</h3>
<p>Swagger ha semplificato lo sviluppo delle API e il loro
funzionamento, ma non è sostenibile per testare chiamate API successive
che seguono un certo ordine o che necessitano di payload specifici.
Postman è stato fondamentale per risolvere questo problema.</p>
<p>È stata creata una raccolta di richieste, comodamente esportate da
Swagger senza alcun bisogno di riscrittura. Queste possono contenere
payload parametrizzati grazie alle variabili di ambiente settabili una
volta per tutte, come ad esempio il GameID, che altrimenti, una volta
creato, deve essere copiato e incollato in ogni richiesta successiva che
lo richiede.</p>
<p>L’altro grande vantaggio di utilizzare Postman è stata la
funzionalità Flows, che permette di creare un diagramma di flusso delle
richieste e di salvare alcune risposte in variabili. Fino a quando non
si è arrivati ad avere un frontend funzionante, questi Flows sono stati
utili per trovare eventuali bug e avere ben chiaro il flusso di chiamate
che sarebbero dovute essere implementate nel frontend, il che ha
velocizzato lo sviluppo del frontend, seppur in minima parte.</p>
<p>È stato realizzato un flow che simulasse la creazione di una partita,
l’iscrizione di 4 giocatori, l’avvio della partita e la simulazione di
un turno completo di gioco. Questo ha permesso di testare in modo
spedito molte delle funzionalità del sistema, e di trovare eventuali bug
in modo altrettanto rapido.</p>
<p><img src="report/img/postManFlow.png" style="width:18cm;height:10cm"
alt="image" /><br />
</p>
<h3 id="log-automatici">Log automatici</h3>
<p>Il servizio core del sistema è il middleware e per poterlo monitorare
è stato necessario implementare un sistema di log automatici. Tenere
traccia di tutte le operazioni è un compito molto complesso e avrebbe
reso difficile un eventuale debug su un software in produzione che in
caso di errore potrebbe riavviarsi e perdere definitivamente
quell’errore. Grazie a Vertx, che offre "gratuitamente" un logger, e
alla libreria <a
href="https://mvnrepository.com/artifact/ch.qos.logback/logback-classic"><u>LogBack</u></a>,
i log legati alle funzionalità più importanti sono trascritti su file
.log in modo da poterli analizzare in caso di problemi.</p>
<p>Questo sistema poi si è evoluto grazie a una configurazione di
LogBack in un file XML, tramite il quale è possibile personalizzare
completamente il sistema di log, decidendo quali package loggare, in
quali file trascriverli, scegliere il livello di log (info, debug,
error, ecc.) e attuare un sistema di log rotate. Secondo questa
configurazione, i log oltre una certa dimensione vengono compressi e
rinominati per non occupare troppo spazio, e si può anche impostare il
numero di questi file compressi da mantenere.</p>
<div class="sourceCode" id="list:xml_logback" data-language="Xml"
data-caption="File configurazione Log automatici"
label="list:xml_logback"><pre class="sourceCode Xml"><code class="sourceCode xml"><span id="list:xml_logback-1"><a href="#list:xml_logback-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">appender</span><span class="ot"> name=</span><span class="st">&quot;DEBUG_LOG&quot;</span><span class="ot"> class=</span><span class="st">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span>
<span id="list:xml_logback-2"><a href="#list:xml_logback-2" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">file</span>&gt;${DEBUG_FILE}&lt;/<span class="kw">file</span>&gt;</span>
<span id="list:xml_logback-3"><a href="#list:xml_logback-3" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">rollingPolicy</span><span class="ot"> class=</span><span class="st">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span>
<span id="list:xml_logback-4"><a href="#list:xml_logback-4" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">fileNamePattern</span>&gt;${DEBUG_FILE}.%d{yyyy-MM-dd}.%i.gz&lt;/<span class="kw">fileNamePattern</span>&gt;</span>
<span id="list:xml_logback-5"><a href="#list:xml_logback-5" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">maxFileSize</span>&gt;900MB&lt;/<span class="kw">maxFileSize</span>&gt;</span>
<span id="list:xml_logback-6"><a href="#list:xml_logback-6" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">maxHistory</span>&gt;14&lt;/<span class="kw">maxHistory</span>&gt;</span>
<span id="list:xml_logback-7"><a href="#list:xml_logback-7" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">totalSizeCap</span>&gt;2GB&lt;/<span class="kw">totalSizeCap</span>&gt;</span>
<span id="list:xml_logback-8"><a href="#list:xml_logback-8" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">rollingPolicy</span>&gt;</span>
<span id="list:xml_logback-9"><a href="#list:xml_logback-9" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">encoder</span>&gt;</span>
<span id="list:xml_logback-10"><a href="#list:xml_logback-10" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">pattern</span>&gt;${LOG_PATTERN}&lt;/<span class="kw">pattern</span>&gt;</span>
<span id="list:xml_logback-11"><a href="#list:xml_logback-11" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">encoder</span>&gt;</span>
<span id="list:xml_logback-12"><a href="#list:xml_logback-12" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">appender</span>&gt;</span>
<span id="list:xml_logback-13"><a href="#list:xml_logback-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:xml_logback-14"><a href="#list:xml_logback-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:xml_logback-15"><a href="#list:xml_logback-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Il package game usera la configurazione del log di debug --&gt;</span></span>
<span id="list:xml_logback-16"><a href="#list:xml_logback-16" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">logger</span><span class="ot"> level=</span><span class="st">&quot;INFO&quot;</span><span class="ot"> name=</span><span class="st">&quot;game&quot;</span><span class="ot"> additivity=</span><span class="st">&quot;false&quot;</span>&gt;</span>
<span id="list:xml_logback-17"><a href="#list:xml_logback-17" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">appender-ref</span><span class="ot"> ref=</span><span class="st">&quot;DEBUG_LOG_ASYNC&quot;</span>/&gt;</span>
<span id="list:xml_logback-18"><a href="#list:xml_logback-18" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">logger</span>&gt;</span></code></pre></div>
<p>Questo sistema si adatta perfettamente a un software dockerizzabile
che ha montato un volume relativo alla cartella /log, che può anche
essere un volume remoto, da cui è possibile consultare velocemente i log
in caso di problemi.</p>
<div class="sourceCode" id="list:dockerfile_log" data-language="Python"
data-caption="Volume di log nel dockerfile l.13 da montare successivamente"
label="list:dockerfile_log"><pre class="sourceCode python"><code class="sourceCode python"><span id="list:dockerfile_log-1"><a href="#list:dockerfile_log-1" aria-hidden="true" tabindex="-1"></a>FROM gradle:<span class="fl">8.6.0</span><span class="op">-</span>jdk17 AS build</span>
<span id="list:dockerfile_log-2"><a href="#list:dockerfile_log-2" aria-hidden="true" tabindex="-1"></a>COPY <span class="op">--</span>chown<span class="op">=</span>gradle:gradle . <span class="op">/</span>home<span class="op">/</span>gradle<span class="op">/</span>src</span>
<span id="list:dockerfile_log-3"><a href="#list:dockerfile_log-3" aria-hidden="true" tabindex="-1"></a>WORKDIR <span class="op">/</span>home<span class="op">/</span>gradle<span class="op">/</span>src</span>
<span id="list:dockerfile_log-4"><a href="#list:dockerfile_log-4" aria-hidden="true" tabindex="-1"></a>RUN gradle assemble</span>
<span id="list:dockerfile_log-5"><a href="#list:dockerfile_log-5" aria-hidden="true" tabindex="-1"></a>RUN gradle fatJar </span>
<span id="list:dockerfile_log-6"><a href="#list:dockerfile_log-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:dockerfile_log-7"><a href="#list:dockerfile_log-7" aria-hidden="true" tabindex="-1"></a>FROM openjdk:<span class="dv">19</span></span>
<span id="list:dockerfile_log-8"><a href="#list:dockerfile_log-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:dockerfile_log-9"><a href="#list:dockerfile_log-9" aria-hidden="true" tabindex="-1"></a>RUN mkdir <span class="op">/</span>app</span>
<span id="list:dockerfile_log-10"><a href="#list:dockerfile_log-10" aria-hidden="true" tabindex="-1"></a>RUN mkdir <span class="op">/</span>app<span class="op">/</span>log</span>
<span id="list:dockerfile_log-11"><a href="#list:dockerfile_log-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:dockerfile_log-12"><a href="#list:dockerfile_log-12" aria-hidden="true" tabindex="-1"></a>COPY <span class="op">--</span><span class="im">from</span><span class="op">=</span>build <span class="op">/</span>home<span class="op">/</span>gradle<span class="op">/</span>src<span class="op">/</span>app<span class="op">/</span>build<span class="op">/</span>libs<span class="op">/</span> <span class="op">/</span>app<span class="op">/</span></span>
<span id="list:dockerfile_log-13"><a href="#list:dockerfile_log-13" aria-hidden="true" tabindex="-1"></a>COPY <span class="op">--</span><span class="im">from</span><span class="op">=</span>build <span class="op">/</span>home<span class="op">/</span>gradle<span class="op">/</span>src<span class="op">/</span>app<span class="op">/</span>log <span class="op">/</span>app<span class="op">/</span>log</span>
<span id="list:dockerfile_log-14"><a href="#list:dockerfile_log-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:dockerfile_log-15"><a href="#list:dockerfile_log-15" aria-hidden="true" tabindex="-1"></a>EXPOSE <span class="dv">3003</span></span>
<span id="list:dockerfile_log-16"><a href="#list:dockerfile_log-16" aria-hidden="true" tabindex="-1"></a>ENTRYPOINT [<span class="st">&quot;java&quot;</span>,<span class="st">&quot;-jar&quot;</span>,<span class="st">&quot;/app/Middleware.jar&quot;</span>]</span></code></pre></div>
<h3 id="checkstyle-javadoc-github-page">Checkstyle, javadoc, github page
</h3>
<p>Dopo aver eseguito i controlli di stile sul codice sono stati trovati
numerosi errori e warning, che sono stati corretti automaticamente da un
plugin che ha sistemato ciò che Spotless non era riuscito a correggere.
Il plugin in questione è <a
href="https://github.com/openrewrite/rewrite"><u>OpenRewrite</u></a>,
che ha permesso di correggere molti errori e di risparmiare un lungo e
noioso lavoro di correzione manuale.</p>
<div class="sourceCode" id="list:openrewrite" data-language="Bash"
data-caption="Output di OpenRewrite" label="list:openrewrite"><pre
class="sourceCode Bash"><code class="sourceCode bash"><span id="list:openrewrite-1"><a href="#list:openrewrite-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Changes</span> have been made to app<span class="dt">\s</span>rc<span class="dt">\m</span>ain<span class="dt">\j</span>ava<span class="dt">\u</span>serModule<span class="dt">\U</span>serController.java by:</span>
<span id="list:openrewrite-2"><a href="#list:openrewrite-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">org.openrewrite.staticanalysis.CodeCleanup</span></span>
<span id="list:openrewrite-3"><a href="#list:openrewrite-3" aria-hidden="true" tabindex="-1"></a>        <span class="ex">org.openrewrite.java.format.MethodParamPad</span></span>
<span id="list:openrewrite-4"><a href="#list:openrewrite-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Changes</span> have been made to app<span class="dt">\s</span>rc<span class="dt">\m</span>ain<span class="dt">\j</span>ava<span class="dt">\u</span>serModule<span class="dt">\U</span>serService.java by:</span>
<span id="list:openrewrite-5"><a href="#list:openrewrite-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">org.openrewrite.staticanalysis.CodeCleanup</span></span>
<span id="list:openrewrite-6"><a href="#list:openrewrite-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">org.openrewrite.staticanalysis.NeedBraces</span></span>
<span id="list:openrewrite-7"><a href="#list:openrewrite-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Changes</span> have been made to app<span class="dt">\s</span>rc<span class="dt">\t</span>est<span class="dt">\j</span>ava<span class="dt">\i</span>ntegration<span class="dt">\B</span>usinessLogicTestIntegration.java by:</span>
<span id="list:openrewrite-8"><a href="#list:openrewrite-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">org.openrewrite.staticanalysis.CodeCleanup</span></span>
<span id="list:openrewrite-9"><a href="#list:openrewrite-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">org.openrewrite.java.format.MethodParamPad</span></span>
<span id="list:openrewrite-10"><a href="#list:openrewrite-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Please</span> review and commit the results.</span>
<span id="list:openrewrite-11"><a href="#list:openrewrite-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Estimate</span> time saved: 1h 24m </span></code></pre></div>
<p>Dopo aver corretto gli errori di stile, è stato generato il Javadoc
per il codice, in modo da avere una documentazione automatica e
aggiornata. Inoltre, è stato creato un sito web tramite GitHub Pages per
avere una documentazione più user-friendly e facilmente accessibile.</p>
<p>Per fare ciò si è optato per l’utilizzo di una GitHub Action che,
tramite condizioni come una push su determinati branch, genera
automaticamente il Javadoc. Questa documentazione viene pubblicata su un
branch ‘javadoc‘, automaticamente creato, e tramite le impostazioni del
repository, viene pubblicata su GitHub Pages, in modo da avere una
documentazione sempre aggiornata e facilmente accessibile.</p>
<p><img src="report/img/github_javadoc.jpg" style="width:12cm"
alt="image" /><br />
La documentazione del componente middleware sarà sempre reperibile all’
indirizzo delle githubpages del progetto con il suffisso javadoc<br />
come ad esempio <a
href="https://sofy24.github.io/MiddlewareMaraffa/javadoc/"><u>https://sofy24.github.io/MiddlewareMaraffa/javadoc/</u></a>.</p>
<div class="sourceCode" id="list:javadoc_action" data-language="Bash"
data-caption="Configurazione della GitHub Action per il Javadoc"
label="list:javadoc_action"><pre class="sourceCode Bash"><code class="sourceCode bash"><span id="list:javadoc_action-1"><a href="#list:javadoc_action-1" aria-hidden="true" tabindex="-1"></a><span class="ex">name:</span> Deploy Javadoc</span>
<span id="list:javadoc_action-2"><a href="#list:javadoc_action-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:javadoc_action-3"><a href="#list:javadoc_action-3" aria-hidden="true" tabindex="-1"></a><span class="ex">on:</span></span>
<span id="list:javadoc_action-4"><a href="#list:javadoc_action-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">push:</span></span>
<span id="list:javadoc_action-5"><a href="#list:javadoc_action-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">branches:</span> [main, <span class="st">&quot;develop&quot;</span>, <span class="st">&quot;style-doc&quot;</span>]</span>
<span id="list:javadoc_action-6"><a href="#list:javadoc_action-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:javadoc_action-7"><a href="#list:javadoc_action-7" aria-hidden="true" tabindex="-1"></a><span class="ex">jobs:</span></span>
<span id="list:javadoc_action-8"><a href="#list:javadoc_action-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">publish:</span></span>
<span id="list:javadoc_action-9"><a href="#list:javadoc_action-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">runs-on:</span> ubuntu-22.04</span>
<span id="list:javadoc_action-10"><a href="#list:javadoc_action-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">permissions:</span></span>
<span id="list:javadoc_action-11"><a href="#list:javadoc_action-11" aria-hidden="true" tabindex="-1"></a>      <span class="ex">contents:</span> write <span class="co"># if you have a protection rule on your repository, you&#39;ll need to give write permission to the workflow.</span></span>
<span id="list:javadoc_action-12"><a href="#list:javadoc_action-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">steps:</span></span>
<span id="list:javadoc_action-13"><a href="#list:javadoc_action-13" aria-hidden="true" tabindex="-1"></a>      <span class="ex">-</span> name: Checkout</span>
<span id="list:javadoc_action-14"><a href="#list:javadoc_action-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">uses:</span> actions/checkout@v4</span>
<span id="list:javadoc_action-15"><a href="#list:javadoc_action-15" aria-hidden="true" tabindex="-1"></a>      <span class="ex">-</span> name: Deploy JavaDoc</span>
<span id="list:javadoc_action-16"><a href="#list:javadoc_action-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">uses:</span> MathieuSoysal/Javadoc-publisher.yml@v2.5.0</span>
<span id="list:javadoc_action-17"><a href="#list:javadoc_action-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">with:</span></span>
<span id="list:javadoc_action-18"><a href="#list:javadoc_action-18" aria-hidden="true" tabindex="-1"></a>          <span class="ex">GITHUB_TOKEN:</span> <span class="va">${</span><span class="er">{ secrets.GITHUB_TOKEN </span><span class="va">}</span>}</span>
<span id="list:javadoc_action-19"><a href="#list:javadoc_action-19" aria-hidden="true" tabindex="-1"></a>          <span class="ex">javadoc-source-folder:</span> app/build/docs/javadoc</span>
<span id="list:javadoc_action-20"><a href="#list:javadoc_action-20" aria-hidden="true" tabindex="-1"></a>          <span class="ex">javadoc-branch:</span> javadoc</span>
<span id="list:javadoc_action-21"><a href="#list:javadoc_action-21" aria-hidden="true" tabindex="-1"></a>          <span class="ex">java-version:</span> 20</span>
<span id="list:javadoc_action-22"><a href="#list:javadoc_action-22" aria-hidden="true" tabindex="-1"></a>          <span class="ex">target-folder:</span> javadoc  <span class="co"># url will be https://&lt;username&gt;.github.io/&lt;repo&gt;/javadoc, This can be left as nothing to generate javadocs in the root folder.</span></span>
<span id="list:javadoc_action-23"><a href="#list:javadoc_action-23" aria-hidden="true" tabindex="-1"></a>          <span class="ex">project:</span> gradle</span></code></pre></div>
<h3 id="lettura-variabili-dambiente">Lettura variabili d’ambiente</h3>
<p>Data la scelta di dockerizzare interamente i servizi, è stato
necessario l’utilizzo di variabili d’ambiente. Questo ha permesso di
creare un sistema di deploy molto flessibile, in cui è possibile
cambiare l’indirizzo del servizio a cui connettersi semplicemente
modificando il file di configurazione del Docker Compose. I servizi in
NodeJS leggono il contenuto delle variabili d’ambiente tramite il modulo
‘process.env‘, mentre i servizi in Java utilizzano ‘System.getenv‘.
Questi comportamenti sono corretti per lo sviluppo locale e per ambienti
di produzione in cui le variabili d’ambiente sono settate
correttamente.</p>
<p>Per quanto riguarda invece lo sviluppo in CI, è stato necessario
creare un file ‘.env.example‘ che contenesse tutte le variabili
d’ambiente necessarie al funzionamento del servizio, in modo da poterle
settare correttamente nel CI/CD, soprattutto per la fase di testing, e
metterlo sulla repository. È importante tenere a mente che non
dovrebbero mai essere caricati dati sensibili su strumenti di controllo
di versione. In questo caso, non ci sono database o account cloud
eventualmente raggiungibili dall’esterno.</p>
<h2 id="riflessioni-sulla-politiche-di-autovalutazione">Riflessioni
sulla politiche di autovalutazione</h2>
<ul>
<li><p><strong>l’elenco delle partite iniziate/finite deve rimanere
aggiornato:</strong> la reattività è stata garantita grazie alle
WebSocket.</p></li>
<li><p><strong>se un giocatore si disconnette la partita termina per
tutti:</strong> analizzando i casi pratici si è notato che quando un
giocatore si disconnette è perchè non ha intenzione di rientrare, è
pertanto inutile far attendere gli altri giocatori per una possibile
riconnessione. Ogni giocatore viene notificato che la partita è stata
terminata e, successivamente, vengono reindirizzati alla
dashboard</p></li>
<li><p><strong>connessione lenta o malfunzionamenti da parte di un
giocatore:</strong> il giocatore potrà rimanere sempre aggiornato sullo
stato corrente della partita riaggiornado la pagina</p></li>
<li><p><strong>un giocatore clicca sul tasto "esci":</strong> allo
stesso modo della disconessione, verrà comunicato a tutti gli altri
giocatori che la partita è terminata e verranno reindirizzati alla
schermata principale</p></li>
<li><p><strong>nel caso di un crash di un servizio si deve garantire che
il servizio venga riavviato in automatico evitando che il sistema si
blocchi:</strong> se crasha un servizio docker ha una funzione builtin
per riavviare in automatico il container</p></li>
</ul>
<h2 id="mockup">Mockup</h2>
<p>Per soddisfare le aspettative degli utenti di Maraffa sono stati
realizzati dei mockup. Grazie a questi si è riuscito a raccogliere
opinioni per migliorare l’interfaccia grafica e l’usabilità del sito. Si
riportano di seguito:</p>
<figure id="mockup">
<img src="report/img/login_register_mockup.png" />
<figcaption>Mockup della schermata di Login e Registrazione</figcaption>
</figure>
<figure id="mockup">
<img src="report/img/dashboard_mockup.png" />
<figcaption>Mockup della dashboard</figcaption>
</figure>
<figure id="mockup">
<img src="report/img/change_pwd_mockup.png" />
<figcaption> Mockup cambio password</figcaption>
</figure>
<figure id="mockup">
<img src="report/img/waiting_room_mockup.png" />
<figcaption>Mockup della Waiting Room</figcaption>
</figure>
<figure id="mockup">
<img src="report/img/profilo_utente_mockup.png" />
<figcaption>Mockup del profilo dell’utente</figcaption>
</figure>
<figure id="mockup">
<img src="report/img/game_mockup.png" />
<figcaption> Mockup della schermata di gioco</figcaption>
</figure>
<h2 id="screen">Screen</h2>
<figure id="screen">
<img src="report/img/login.png" />
<figcaption>Screen della schermata di Login e Registrazione</figcaption>
</figure>
<figure id="screen">
<img src="report/img/register.png" />
<figcaption>Screen della schermata Registrazione</figcaption>
</figure>
<figure id="screen">
<img src="report/img/dashboard.png" />
<figcaption>Screen Dashboard</figcaption>
</figure>
<figure id="screen">
<img src="report/img/changePWD.png" />
<figcaption>Screen cambio password</figcaption>
</figure>
<figure id="screen">
<img src="report/img/waiting_room.png" />
<figcaption>Screen della schermata waiting room</figcaption>
</figure>
<figure id="screen">
<img src="report/img/userpage.png" />
<figcaption>Screen del profilo dell’utente</figcaption>
</figure>
<figure id="screen">
<img src="report/img/game.png" />
<figcaption> Screen della schermata di gioco</figcaption>
</figure>
<h1 id="ch:interazioni">Interazioni</h1>
<h2 id="frontend-leftrightarrow-websocket">Frontend <span
class="math inline">↔︎</span> WebSocket</h2>
<p>Come precedentemente citato, il middleware è stato implementato con
WebSocket per poter comunicare in modo reattivo con il frontend. Queste
comunicazioni frontend &lt;-&gt; middleware sono in buona parte scambi
di messaggi tramite HTTP, ma in alcuni casi è necessario un canale di
comunicazione bidirezionale. Uno degli esempi più "eclatanti" è la
dashboard, in cui, in una prima implementazione, era stato utilizzato un
polling per aggiornare i dati riguardanti le partite in corso per
permettere agli utenti di partecipare. Immaginando uno scenario
distribuito in cui ci sono N utenti contemporaneamente connessi al
sistema, quella soluzione avrebbe sovraccaricato il sistema. Invece,
tramite il canale bidirezionale delle WebSocket, è direttamente il
middleware, che al proprio interno ha un servizio che mantiene una mappa
dei client connessi, a notificare tramite un’operazione di broadcast
tutti i client della creazione di una nuova partita.</p>
<h3 id="chat-globale-e-privata">Chat globale e privata</h3>
<p>Un grande vantaggio dell’uso delle WebSocket sta nella facile
implementazione delle chat. Questo sistema richiedeva l’impiego di due
diverse chat per permettere la comunicazione tra utenti sia globalmente
che all’interno di una singola partita. Anche in questo caso, il
middleware si occupa di instradare i messaggi alle giuste chat,
garantendo la privacy delle conversazioni. Il frontend, invece, si
occupa di visualizzare i messaggi e di inviarli al middleware. La
gestione della persistenza delle chat è stata implementata tramite l’uso
del session storage del browser all’interno del middleware, permettendo
di mantenere la chat anche in caso di refresh della pagina.</p>
<h3 id="reattività-e-aggiornamento-in-tempo-reale">Reattività e
aggiornamento in tempo reale</h3>
<p>Tramite l’utilizzo delle WebSocket, è possibile ottenere un
aggiornamento in tempo reale delle informazioni, senza dover fare
polling continuo al server. Questa tecnologia è stata ampiamente
utilizzata nella pagina della partita, permettendo ai client di ricevere
aggiornamenti immediati, ad esempio sulle carte giocate da altri
giocatori o su eventi scatenati da azioni specifiche, come l’abbandono
di un giocatore, la gestione dei punteggi o la conclusione della partita
stessa.</p>
<h2 id="stack-docker-rightarrow-reti-interne-e-ip-privati">Stack Docker
<span class="math inline">→</span> reti interne e IP privati</h2>
<p>Il sistema è stato progettato per essere eseguito su qualsiasi
piattaforma e si è arrivati a creare uno stack completo di Docker
Compose. Questo ha permesso anche la creazione di reti interne tra i
container che vengono utilizzate per la comunicazione tra i servizi. È
stato possibile assegnare IP privati ai container, permettendo di non
esporre i servizi all’esterno e di mantenere un’architettura più sicura.
Tra le variabili d’ambiente che vengono passate ai container c’è anche
l’indirizzo del servizio a cui connettersi, e questo indirizzo è il nome
del servizio all’interno della rete. Questo permette di non dover
modificare il codice ogni volta che si cambia l’indirizzo del servizio a
cui connettersi, ma basta modificare il file di configurazione del
Docker Compose.</p>
<h3 id="Nginx">Nginx</h3>
<p>Per quanto riguarda il frontend, è stato utilizzato Nginx per
eseguire l’applicazione all’interno del container e per poterla
raggiungere dall’esterno. Per fare ciò è stato necessario configurare
Nginx tramite un file di configurazione che ha permesso anche di gestire
un’operazione di reverse proxy per indirizzare le chiamate al
backend.</p>
<div class="sourceCode" id="list:nginx_frontend" data-language="Python"
data-caption="Configurazione Nginx del front-end"
label="list:nginx_frontend"><pre class="sourceCode python"><code class="sourceCode python"><span id="list:nginx_frontend-1"><a href="#list:nginx_frontend-1" aria-hidden="true" tabindex="-1"></a>server {</span>
<span id="list:nginx_frontend-2"><a href="#list:nginx_frontend-2" aria-hidden="true" tabindex="-1"></a>    listen <span class="dv">80</span><span class="op">;</span></span>
<span id="list:nginx_frontend-3"><a href="#list:nginx_frontend-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="list:nginx_frontend-4"><a href="#list:nginx_frontend-4" aria-hidden="true" tabindex="-1"></a>    location <span class="op">/</span> {</span>
<span id="list:nginx_frontend-5"><a href="#list:nginx_frontend-5" aria-hidden="true" tabindex="-1"></a>        root <span class="op">/</span>usr<span class="op">/</span>share<span class="op">/</span>nginx<span class="op">/</span>html<span class="op">;</span></span>
<span id="list:nginx_frontend-6"><a href="#list:nginx_frontend-6" aria-hidden="true" tabindex="-1"></a>        index index.html index.htm<span class="op">;</span></span>
<span id="list:nginx_frontend-7"><a href="#list:nginx_frontend-7" aria-hidden="true" tabindex="-1"></a>        try_files $uri $uri<span class="op">/</span> <span class="op">/</span>index.html<span class="op">;</span></span>
<span id="list:nginx_frontend-8"><a href="#list:nginx_frontend-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="list:nginx_frontend-9"><a href="#list:nginx_frontend-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:nginx_frontend-10"><a href="#list:nginx_frontend-10" aria-hidden="true" tabindex="-1"></a>    location <span class="op">/</span>api<span class="op">/</span> {</span>
<span id="list:nginx_frontend-11"><a href="#list:nginx_frontend-11" aria-hidden="true" tabindex="-1"></a>        proxy_pass <span class="st">&quot;http://$</span><span class="sc">{API_HOST}</span><span class="st">:$</span><span class="sc">{API_PORT}</span><span class="st">/&quot;</span><span class="op">;</span></span>
<span id="list:nginx_frontend-12"><a href="#list:nginx_frontend-12" aria-hidden="true" tabindex="-1"></a>        proxy_http_version <span class="fl">1.1</span><span class="op">;</span></span>
<span id="list:nginx_frontend-13"><a href="#list:nginx_frontend-13" aria-hidden="true" tabindex="-1"></a>        proxy_set_header Upgrade $http_upgrade<span class="op">;</span></span>
<span id="list:nginx_frontend-14"><a href="#list:nginx_frontend-14" aria-hidden="true" tabindex="-1"></a>        proxy_set_header Connection <span class="st">&#39;upgrade&#39;</span><span class="op">;</span></span>
<span id="list:nginx_frontend-15"><a href="#list:nginx_frontend-15" aria-hidden="true" tabindex="-1"></a>        proxy_set_header Host $host<span class="op">;</span></span>
<span id="list:nginx_frontend-16"><a href="#list:nginx_frontend-16" aria-hidden="true" tabindex="-1"></a>        proxy_cache_bypass $http_upgrade<span class="op">;</span></span>
<span id="list:nginx_frontend-17"><a href="#list:nginx_frontend-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="list:nginx_frontend-18"><a href="#list:nginx_frontend-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>La scelta di Nginx è stata fatta soprattutto per la sicurezza nel
"mascherare" le chiamate fatte al backend, in modo da non esporre
l’indirizzo del servizio all’esterno e poter superare eventuali problemi
di CORS. L’indirizzo del backend è stato configurato anch’esso tramite
variabili d’ambiente, in modo da poterlo cambiare facilmente in base
all’ambiente in cui si trova il container, e queste variabili vengono
sostituite a seconda dell’ambiente di deploy in cui l’applicativo
Angular viene eseguito.</p>
<h1 id="ch:DevOps">DevOps</h1>
<h2 id="dvcs">DVCS</h2>
<p>Come strumento di controllo di versione è stato scelto git, sono
state adottate le seguenti best practices o git policy per garantire un
flusso di lavoro coerente e prevenire conflitti di merge.</p>
<h3 id="struttura-dei-branch">Struttura dei Branch</h3>
<p>Una delle componenti principali della Git Policy è la gestione dei
branch. La struttura tipica prevede almeno tre tipi di branch: -
<strong>Master/Main:</strong> Questo è il branch principale che contiene
il codice di produzione. Ogni commit su questo branch dovrebbe essere
stabile e pronto per il rilascio. Questo branch e stato protetto per
evitare commit diretti, richiedendo quindi una revisione per ogni
operazione di merge. - <strong>Develop:</strong> Qui viene integrato il
lavoro di sviluppo corrente. È il branch dove confluiscono le feature
prima di essere preparate per il rilascio. Questo branch dovrebbe essere
costantemente aggiornato e testato per assicurare che sia in uno stato
pronto per la produzione. - <strong>Feature Branches:</strong>
Utilizzati per lo sviluppo di nuove funzionalità. Ogni feature branch
deve derivare da ‘develop‘ e, una volta completata la feature, viene
reintegrato in ‘develop‘ tramite una pull request.</p>
<h3 id="conventional-commits">Conventional commits</h3>
<p>La pratica adottata per i commit è stata quella di effettuare commit
frequenti e significativi.</p>
<p>In ogni repo è stato adottato un sistema standard per scrivere i
commit: i conventional commit. In questo modo i commit risultano più
chiari e facilmente leggibili. Riportiamo di seguito la nomenclatura
usata:</p>
<ul>
<li><p><strong>fix:</strong> per i commit che risolvono un bug</p></li>
<li><p><strong>feat:</strong> per i commit che aggiungono una nuova
feature</p></li>
<li><p><strong>refactor:</strong> per i commit che migliorano il codice
senza aggiungere nuove funzionalità</p></li>
<li><p><strong>docs:</strong> per i commit che riguardano la
documentazione</p></li>
<li><p><strong>style:</strong> per i commit che riguardano la
formattazione del codice</p></li>
<li><p><strong>test:</strong> per i commit che riguardano i
test</p></li>
<li><p><strong>ci:</strong> per i commit che riguardano la Continuous
Integration</p></li>
</ul>
<p>Inoltre sono evidenziati i breaking changes per le modifiche non più
compatibili con le versioni precedenti. La stessa nomenclatura viene
utilizzata anche nel changelog.</p>
<h2 id="issue-template">Issue template</h2>
<p>Il codice è open source ed è incoraggiata la collaborazione anche
grazie alla presenza, in ogni repository, di template con i quali un
utente può consigliare nuove feature, segnalare un bug o suggerire
un’implementazione alternativa. Sono estremamente utili per ricevere
feedback dagli utenti e monitorare gli eventuali bug.</p>
<h2 id="build-automation">Build automation</h2>
<p>Abbiamo deciso di implementare ogni servizio in una repository
diversa. La repository fornita è un contenitore di tutte le singole
repository dei servizi. Per ogni repository è stata implementata una
build automation specifica.<br />
In questo modo si riesce a automatizzare i processi di build, test e
deploy, ottenendo diversi vantaggi:</p>
<ul>
<li><p>si riduce drasticamente il tempo per la compilazione del
codice</p></li>
<li><p>ogni volta i passaggi verranno eseguiti allo stesso modo
ottenendo, quindi, riproducibilità</p></li>
<li><p>si identificano facilmente i problemi grazie al sistema di stampe
a video che si ottiene durante l’esecuzione delle GitHub
Actions</p></li>
<li><p>minimizzazione degli errori umani</p></li>
<li><p>garantisce il continuous deployment</p></li>
</ul>
<h3 id="scheletro-del-workflow">Scheletro del workflow</h3>
<p>I workflow utilizzati in questo progetto, pur utilizzando actions
diverse specifiche per ogni servizio e linguaggio, seguono uno schema
comune che ne facilita lo sviluppo e la manutenzione.</p>
<p>Ogni workflow di deployment è composto da tre job principali: build,
test e deploy. Seguono una logica sequenziale e non parallela, in cui la
fine di ogni job decreta l’inizio di quello successivo. Il collegamento
tra i job è garantito da un sistema di cache, che permette di passare i
dati tra i vari job migliorandone l’efficienza e la velocità. Questi job
vengono attivati secondo alcune regole di progetto comuni alle
repository, in linea con il workflow adottato. Questi ultimi non sono
attivati ad ogni commit, ma solo in determinate circostanze, qui di
seguito elencate:</p>
<ul>
<li><p><strong>Pull request su develop</strong></p></li>
<li><p><strong>Release manuale su main pubblicata</strong></p></li>
</ul>
<p>La struttura dei workflow è stata progettata per essere il più
modulare possibile. Sono state utilizzate variabili d’ambiente per
differenziare il deploy su develop e main, in modo da poter riutilizzare
lo stesso workflow per entrambi i branch e produrre diverse immagini del
software. Il nome dell’immagine pubblicata viene creato in modo
parametrico, utilizzando il nome della repository, modificando i
caratteri in minuscolo e aggiungendo la versione del software, che viene
presa dal tag della release o impostata su stage o develop a seconda del
branch che ha attivato il workflow.</p>
<h3 id="usermanagement-e-businesslogic">UserManagement e
BusinessLogic</h3>
<p>Essendo le due repository estremamente simili e avendo entrambe un
ambiente in Node.js, è stato implementato un workflow pressoché analogo.
Le actions utilizzate sono quelle di Yarn per le varie fasi di build,
test e deploy, e per la creazione della cache tra i vari job.</p>
<h3 id="middleware-1">Middleware</h3>
<p>Questa repository è stata implementata in Java, quindi il workflow è
stato leggermente diverso. Per le varie fasi sono state utilizzate le
action di Java e Gradle. Per il corretto funzionamento della action di
setup e quindi delle successive, si è reso necessario, anche se non
previsto e non consigliato, mantenere sul repository remoto il file
‘gradle-wrapper.jar‘. Per la fase di test, invece, è stata utilizzata
un’action che permette di creare un container con un database di
MongoDB, in modo da poter testare il codice che interagisce con un
database, il che compone una delle funzionalità principali del servizio.
Anche in questo caso, password e username vengono passati tramite i
secrets.</p>
<h3 id="frontend">Frontend</h3>
<p>La repository di frontend è stata implementata in Angular, quindi il
workflow è stato leggermente diverso. Per le varie fasi sono state
utilizzate le action di Yarn per le fasi di build, deploy e per la
creazione della cache tra i vari job. Non è stato necessario utilizzare
la fase di test, poiché il frontend di un’applicazione non ha un sistema
di unit test; la comunicazione con il middleware viene testata
"manualmente".</p>
<h2 id="continuous-integration">Continuous integration</h2>
<p>Per migliorare la qualità del software e velocizzare il processo di
sviluppo, è stata implementata la Continuous Integration. Questa pratica
permette di integrare il codice frequentemente, evitando possibili
rischi d’integrazione e consetendo l’esecuzione di test automatici.
Grazie al sistema di notifiche, inoltre, è possibile ricevere feedback
immediato sullo stato delle Github Actions, per accertarsi che sia
sempre tutto funzionante e non siano stati introdotti bug. Mantenendo il
sistema continuamente monitorato, si migliora anche l’effiicienza e la
collaborazione tra i membri del team.</p>
<h1 id="ch:validazione">Validazione</h1>
<h2 id="test">Test</h2>
<p>Per ogni servizio in questo sistema è stato adottato, ove possibile,
il paradigma di programmazione TDD, cioè Test Driven Development. Questo
approccio prevede che i test siano scritti prima del codice, in modo da
guidare lo sviluppo e garantire che il codice prodotto soddisfi i
requisiti specificati. Le operazioni di testing sono stata implementate
con Jest per quanto riguarda i servizi che usano Node.js, generando di
fatto un report abbastanza comprensibile. Il componente middleware,
scritto in Java, invece, generava risultati di test non così chiari. Per
modificare questo comportamento, è stata introdotta una dipendenza nel
build Gradle che permette di avere un report più dettagliato e
comprensibile. La libreria <a
href="https://plugins.gradle.org/plugin/com.adarshr.test-logger"><u>Test
Logger</u></a>, tramite una piccola configurazione nel file build.gradle
come qui riportata, ha soddisfatto le nostre esigenze.</p>
<div class="sourceCode" id="list:gradle_testlogger" data-language="Java"
data-caption="Test logger" label="list:gradle_testlogger"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:gradle_testlogger-1"><a href="#list:gradle_testlogger-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">adarshr</span><span class="op">.</span><span class="im">gradle</span><span class="op">.</span><span class="im">testlogger</span><span class="op">.</span><span class="im">TestLoggerExtension</span></span>
<span id="list:gradle_testlogger-2"><a href="#list:gradle_testlogger-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">adarshr</span><span class="op">.</span><span class="im">gradle</span><span class="op">.</span><span class="im">testlogger</span><span class="op">.</span><span class="im">TestLoggerPlugin</span></span>
<span id="list:gradle_testlogger-3"><a href="#list:gradle_testlogger-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">adarshr</span><span class="op">.</span><span class="im">gradle</span><span class="op">.</span><span class="im">testlogger</span><span class="op">.</span><span class="im">theme</span><span class="op">.</span><span class="im">ThemeType</span></span>
<span id="list:gradle_testlogger-4"><a href="#list:gradle_testlogger-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:gradle_testlogger-5"><a href="#list:gradle_testlogger-5" aria-hidden="true" tabindex="-1"></a>testlogger <span class="op">{</span></span>
<span id="list:gradle_testlogger-6"><a href="#list:gradle_testlogger-6" aria-hidden="true" tabindex="-1"></a>    theme <span class="op">=</span> ThemeType<span class="op">.</span><span class="fu">MOCHA</span></span>
<span id="list:gradle_testlogger-7"><a href="#list:gradle_testlogger-7" aria-hidden="true" tabindex="-1"></a>    showExceptions <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-8"><a href="#list:gradle_testlogger-8" aria-hidden="true" tabindex="-1"></a>    showStackTraces <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-9"><a href="#list:gradle_testlogger-9" aria-hidden="true" tabindex="-1"></a>    showFullStackTraces <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-10"><a href="#list:gradle_testlogger-10" aria-hidden="true" tabindex="-1"></a>    showCauses <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-11"><a href="#list:gradle_testlogger-11" aria-hidden="true" tabindex="-1"></a>    slowThreshold <span class="op">=</span> <span class="dv">2000</span></span>
<span id="list:gradle_testlogger-12"><a href="#list:gradle_testlogger-12" aria-hidden="true" tabindex="-1"></a>    showSummary <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-13"><a href="#list:gradle_testlogger-13" aria-hidden="true" tabindex="-1"></a>    showSimpleNames <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-14"><a href="#list:gradle_testlogger-14" aria-hidden="true" tabindex="-1"></a>    showPassed <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-15"><a href="#list:gradle_testlogger-15" aria-hidden="true" tabindex="-1"></a>    showSkipped <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-16"><a href="#list:gradle_testlogger-16" aria-hidden="true" tabindex="-1"></a>    showFailed <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-17"><a href="#list:gradle_testlogger-17" aria-hidden="true" tabindex="-1"></a>    showOnlySlow <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-18"><a href="#list:gradle_testlogger-18" aria-hidden="true" tabindex="-1"></a>    showStandardStreams <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-19"><a href="#list:gradle_testlogger-19" aria-hidden="true" tabindex="-1"></a>    showPassedStandardStreams <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-20"><a href="#list:gradle_testlogger-20" aria-hidden="true" tabindex="-1"></a>    showSkippedStandardStreams <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-21"><a href="#list:gradle_testlogger-21" aria-hidden="true" tabindex="-1"></a>    showFailedStandardStreams <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-22"><a href="#list:gradle_testlogger-22" aria-hidden="true" tabindex="-1"></a>    logLevel <span class="op">=</span> LogLevel<span class="op">.</span><span class="fu">LIFECYCLE</span></span>
<span id="list:gradle_testlogger-23"><a href="#list:gradle_testlogger-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>L’architettura dei componenti si può riassumere in questo modo:</p>
<ul>
<li><p><strong>Classi controller</strong>: che hanno la funzione di
esporre le rotte e di contenere al loro interno classi di
servizio.</p></li>
<li><p><strong>Classi di servizio</strong>: che contengono la logica di
business.</p></li>
</ul>
<p>I test vengono quindi eseguiti sulle classi di servizio, andando a
testare la logica di business e non le funzioni. Questo approccio
permette di avere una copertura maggiore del codice e di garantire che
la logica di business sia corretta. Un esempio di test su una classe di
servizio, prendendo come esempio il componente userManagement, rende
chiaro il concetto.</p>
<p>Questo componente di fatto svolge due funzioni ben distinte:</p>
<ul>
<li><p>Collegarsi a un database MySQL e fare delle operazioni CRUD su
tabelle di utenti e le loro rispettive statistiche.</p></li>
<li><p>Gestire la registrazione e l’autenticazione degli
utenti.</p></li>
</ul>
<p>La parte di testing quindi non va assolutamente a verificare che la
connessione al database funzioni, ma che le operazioni CRUD siano
corrette e che la registrazione e l’autenticazione degli utenti
avvengano correttamente, così come l’aggiornamento delle
statistiche.</p>
<p>Avendo scelto un’architettura a microservizi, è stato necessario
testare anche il corretto funzionamento delle comunicazioni tra i
servizi. Per fare ciò, è stato necessario creare dei test di
integrazione che verificassero il corretto funzionamento delle API
esposte dai servizi. Questi test sono stati implementati nel componente
middleware che, come sicuramente si ricorderà, ha il compito di mettere
in comunicazione i servizi tra di loro e con il frontend.</p>
<h3 id="testing-asincrono">Testing asincrono</h3>
<p>Durante la scrittura dei test all’interno del servizio in Java,
alcune operazioni erano asincrone e quindi è stato necessario attendere
che queste operazioni terminassero prima di poter eseguire i test e
validarli. Per fare ciò, la normale struttura di test fornita da Vertx
in un primo tentativo non era sufficiente. La classica struttura dei
test è la seguente:</p>
<div class="sourceCode" id="list:test_std_vertx" data-language="Java"
data-caption="Standard Vertx test" label="list:test_std_vertx"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:test_std_vertx-1"><a href="#list:test_std_vertx-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="list:test_std_vertx-2"><a href="#list:test_std_vertx-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">createGameTest</span><span class="op">(</span><span class="dt">final</span> VertxTestContext context<span class="op">)</span> <span class="op">{</span></span>
<span id="list:test_std_vertx-3"><a href="#list:test_std_vertx-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> JsonObject gameResponse <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span><span class="op">.</span><span class="fu">createGame</span><span class="op">(</span>MARAFFA_PLAYERS<span class="op">,</span> TEST_USER<span class="op">,</span> EXPECTED_SCORE<span class="op">,</span> GAME_MODE<span class="op">.</span><span class="fu">toString</span><span class="op">(),</span> PASSWORD<span class="op">);</span></span>
<span id="list:test_std_vertx-4"><a href="#list:test_std_vertx-4" aria-hidden="true" tabindex="-1"></a>    Assertions<span class="op">.</span><span class="fu">assertEquals</span><span class="op">(</span>UUID_SIZE<span class="op">,</span> gameResponse<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>Constants<span class="op">.</span><span class="fu">GAME_ID</span><span class="op">).</span><span class="fu">length</span><span class="op">());</span> <span class="co">// Assuming UUID is 36</span></span>
<span id="list:test_std_vertx-5"><a href="#list:test_std_vertx-5" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">completeNow</span><span class="op">();</span></span>
<span id="list:test_std_vertx-6"><a href="#list:test_std_vertx-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Per risolvere questo problema sono stati utilizzati:</p>
<ul>
<li><p>il decoratore fornito da JUnit Jupiter <em>@Timeout</em>, che
permette di aspettare un tempo definito prima di fallire automaticamente
il test, per ovviare al problema di asincronicità con servizi esterni al
componente stesso che non "rispondono alla chiamata".</p></li>
<li><p>l’utilizzo asincrono del VertxTestContext, che permette di
completare il test solo quando tutte le operazioni asincrone sono state
completate.</p></li>
<li><p>una struttura di risposta nei servizi con cui il middleware
comunica, che permette di individuare errori tramite la chiave "error"
in caso di fallimento contenuta all’interno del JSON di risposta. Il
test non può accedere alla response di una chiamata HTTP che normalmente
avrebbe uno status code 200 in caso di successo e quindi si è ricorso a
questo espediente per individuare errori nei dati inviati al
servizio.</p></li>
</ul>
<p>Come è possibile vedere nel test riportato di seguito, seguendo
questi accorgimenti è possibile testare correttamente le operazioni
asincrone.</p>
<div class="sourceCode" id="list:test_async_vertx" data-language="Java"
data-caption="Vertx test asincrono" label="list:test_async_vertx"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:test_async_vertx-1"><a href="#list:test_async_vertx-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Timeout</span><span class="op">(</span>value <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> unit <span class="op">=</span> <span class="bu">TimeUnit</span><span class="op">.</span><span class="fu">SECONDS</span><span class="op">)</span></span>
<span id="list:test_async_vertx-2"><a href="#list:test_async_vertx-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="list:test_async_vertx-3"><a href="#list:test_async_vertx-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">testgetShuffledDeckOK</span><span class="op">(</span><span class="dt">final</span> VertxTestContext context<span class="op">)</span> <span class="op">{</span></span>
<span id="list:test_async_vertx-4"><a href="#list:test_async_vertx-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> JsonObject gameResponse <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span><span class="op">.</span><span class="fu">createGame</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> TEST_USER<span class="op">,</span> <span class="dv">41</span><span class="op">,</span></span>
<span id="list:test_async_vertx-5"><a href="#list:test_async_vertx-5" aria-hidden="true" tabindex="-1"></a>            GameMode<span class="op">.</span><span class="fu">CLASSIC</span><span class="op">.</span><span class="fu">toString</span><span class="op">(),</span> PASSWORD<span class="op">);</span></span>
<span id="list:test_async_vertx-6"><a href="#list:test_async_vertx-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">businessLogicController</span></span>
<span id="list:test_async_vertx-7"><a href="#list:test_async_vertx-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getShuffledDeck</span><span class="op">(</span><span class="bu">UUID</span><span class="op">.</span><span class="fu">fromString</span><span class="op">(</span>gameResponse<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>Constants<span class="op">.</span><span class="fu">GAME_ID</span><span class="op">)),</span> <span class="dv">4</span><span class="op">)</span></span>
<span id="list:test_async_vertx-8"><a href="#list:test_async_vertx-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">whenComplete</span><span class="op">((</span>res<span class="op">,</span> err<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="list:test_async_vertx-9"><a href="#list:test_async_vertx-9" aria-hidden="true" tabindex="-1"></a>                context<span class="op">.</span><span class="fu">verify</span><span class="op">(()</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="list:test_async_vertx-10"><a href="#list:test_async_vertx-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">assertNull</span><span class="op">(</span>res<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;error&quot;</span><span class="op">));</span></span>
<span id="list:test_async_vertx-11"><a href="#list:test_async_vertx-11" aria-hidden="true" tabindex="-1"></a>                    context<span class="op">.</span><span class="fu">completeNow</span><span class="op">();</span></span>
<span id="list:test_async_vertx-12"><a href="#list:test_async_vertx-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">});</span></span>
<span id="list:test_async_vertx-13"><a href="#list:test_async_vertx-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="list:test_async_vertx-14"><a href="#list:test_async_vertx-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="code_quality">Code quality e linting</h2>
<p>Durante lo sviluppo dei servizi è stata adottata una politica di code
quality e linting per garantire la coerenza e la leggibilità del
codice.</p>
<p>Per i servizi in Node.js, sono stati utilizzati ESLint assieme a
Prettier. ESLint è uno strumento di analisi statica del codice che aiuta
a identificare e correggere gli errori di codice, le pratiche non
ottimali e le violazioni dello stile di codice. Questi strumenti
necessitano soltanto di un file di configurazione che è presente nelle
repository e che i software per la scrittura di codice, come ad esempio
VSCode, possono adoperare.</p>
<p>Il componente in Java ha adottato Checkstyle, un tool di analisi
statica del codice che aiuta a garantire che il codice Java rispetti uno
standard di codifica predefinito. Anche in questo caso è stato
sufficiente aggiungere una dipendenza nel build.gradle per ottenere un
report dettagliato e comprensibile ed un file di configurazione che è
stato inserito nella repository. Per automatizzare il processo di
formattazione del codice il più possibile è stata aggiunta la libreria
<a href="https://github.com/diffplug/spotless"><u>Spotless</u></a>.
L’aggiunta di queste dipendenze nel file build.gradle è stata
sufficiente per garantire la formattazione del codice e la sua
coerenza.</p>
<div class="sourceCode" id="list:gradle_codequality"
data-language="Java" data-caption="Code quality"
label="list:gradle_codequality"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:gradle_codequality-1"><a href="#list:gradle_codequality-1" aria-hidden="true" tabindex="-1"></a>spotless <span class="op">{</span></span>
<span id="list:gradle_codequality-2"><a href="#list:gradle_codequality-2" aria-hidden="true" tabindex="-1"></a>    java <span class="op">{</span></span>
<span id="list:gradle_codequality-3"><a href="#list:gradle_codequality-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">importOrder</span><span class="op">()</span> <span class="co">// standard import order</span></span>
<span id="list:gradle_codequality-4"><a href="#list:gradle_codequality-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">removeUnusedImports</span><span class="op">()</span></span>
<span id="list:gradle_codequality-5"><a href="#list:gradle_codequality-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">googleJavaFormat</span><span class="op">()</span> <span class="co">// has its own section below</span></span>
<span id="list:gradle_codequality-6"><a href="#list:gradle_codequality-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">eclipse</span><span class="op">()</span>          <span class="co">// has its own section below</span></span>
<span id="list:gradle_codequality-7"><a href="#list:gradle_codequality-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="list:gradle_codequality-8"><a href="#list:gradle_codequality-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="list:gradle_codequality-9"><a href="#list:gradle_codequality-9" aria-hidden="true" tabindex="-1"></a>checkstyle <span class="op">{</span></span>
<span id="list:gradle_codequality-10"><a href="#list:gradle_codequality-10" aria-hidden="true" tabindex="-1"></a>    toolVersion <span class="op">=</span> <span class="st">&quot;8.44&quot;</span> <span class="co">// Versione di Checkstyle</span></span>
<span id="list:gradle_codequality-11"><a href="#list:gradle_codequality-11" aria-hidden="true" tabindex="-1"></a>    configFile <span class="op">=</span> <span class="fu">file</span><span class="op">(</span><span class="st">&quot;${rootDir}/config/checkstyle/checkstyle.xml&quot;</span><span class="op">)</span> <span class="co">// Configurazione di Checkstyle</span></span>
<span id="list:gradle_codequality-12"><a href="#list:gradle_codequality-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// showViolations = true</span></span>
<span id="list:gradle_codequality-13"><a href="#list:gradle_codequality-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="ch:deployment">Deployment</h1>
<h2 id="containerization">Containerization</h2>
<p>Data l’architettura del progetto in microservizi, usare Docker per
creare un’immagine per ogni servizio è stata una scelta naturale.
L’obiettivo finale è avere un sistema facilmente deployabile e
scalabile, eseguibile velocemente in un ambiente generico, con uno stack
di container Docker che racchiuda tutto il sistema. Per fare ciò è stato
necessario creare un Dockerfile per ogni servizio, in modo da poter
creare un’immagine durante la fase di deploy della continuous
integration.</p>
<p>La <strong>strategia di containerizzazione</strong> per tutte le
immagini create è stata quella di utilizzare un’immagine base di Alpine,
in modo da avere immagini leggere e veloci da scaricare. Per ridurre la
dimensione delle immagini, si è utilizzata un’immagine di sviluppo per
compilare il codice e un’immagine di produzione per eseguire il codice
compilato, copiando solo i file necessari.</p>
<figure>
<p><img src="report/img/multi_stage.png" style="width:12cm"
alt="image" /><br />
</p>
<figcaption>Comparazione tra le immagini multi-stage e le immagini
tradizionali</figcaption>
</figure>
<h3 id="nodejs">NodeJS</h3>
<p>I servizi UserManagementMaraffa e BusinessLogic sono stati
containerizzati utilizzando un’immagine di Node.js. Nell’esempio sotto,
si può notare la distinzione tra i diversi stage.</p>
<div class="sourceCode" id="list:dockerfile_nodejs"
data-language="Python" data-caption="Dockerfile delle immagini NodeJS"
label="list:dockerfile_nodejs"><pre
class="sourceCode python"><code class="sourceCode python"><span id="list:dockerfile_nodejs-1"><a href="#list:dockerfile_nodejs-1" aria-hidden="true" tabindex="-1"></a>FROM node:<span class="dv">20</span><span class="op">-</span>alpine <span class="im">as</span> base</span>
<span id="list:dockerfile_nodejs-2"><a href="#list:dockerfile_nodejs-2" aria-hidden="true" tabindex="-1"></a>WORKDIR <span class="op">/</span>app</span>
<span id="list:dockerfile_nodejs-3"><a href="#list:dockerfile_nodejs-3" aria-hidden="true" tabindex="-1"></a>COPY yarn.lock package.json <span class="op">/</span>app<span class="op">/</span></span>
<span id="list:dockerfile_nodejs-4"><a href="#list:dockerfile_nodejs-4" aria-hidden="true" tabindex="-1"></a>RUN yarn install</span>
<span id="list:dockerfile_nodejs-5"><a href="#list:dockerfile_nodejs-5" aria-hidden="true" tabindex="-1"></a>COPY . <span class="op">/</span>app</span>
<span id="list:dockerfile_nodejs-6"><a href="#list:dockerfile_nodejs-6" aria-hidden="true" tabindex="-1"></a>RUN yarn build</span>
<span id="list:dockerfile_nodejs-7"><a href="#list:dockerfile_nodejs-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:dockerfile_nodejs-8"><a href="#list:dockerfile_nodejs-8" aria-hidden="true" tabindex="-1"></a>FROM node:<span class="dv">20</span><span class="op">-</span>alpine</span>
<span id="list:dockerfile_nodejs-9"><a href="#list:dockerfile_nodejs-9" aria-hidden="true" tabindex="-1"></a>WORKDIR <span class="op">/</span>app    </span>
<span id="list:dockerfile_nodejs-10"><a href="#list:dockerfile_nodejs-10" aria-hidden="true" tabindex="-1"></a>COPY <span class="op">--</span><span class="im">from</span><span class="op">=</span>base <span class="op">/</span>app<span class="op">/</span>package.json <span class="op">/</span>app<span class="op">/</span>package.json</span>
<span id="list:dockerfile_nodejs-11"><a href="#list:dockerfile_nodejs-11" aria-hidden="true" tabindex="-1"></a>COPY <span class="op">--</span><span class="im">from</span><span class="op">=</span>base <span class="op">/</span>app<span class="op">/</span>node_modules <span class="op">/</span>app<span class="op">/</span>node_modules</span>
<span id="list:dockerfile_nodejs-12"><a href="#list:dockerfile_nodejs-12" aria-hidden="true" tabindex="-1"></a>COPY <span class="op">--</span><span class="im">from</span><span class="op">=</span>base <span class="op">/</span>app<span class="op">/</span>dist <span class="op">/</span>app<span class="op">/</span>dist</span>
<span id="list:dockerfile_nodejs-13"><a href="#list:dockerfile_nodejs-13" aria-hidden="true" tabindex="-1"></a>EXPOSE <span class="dv">3000</span></span>
<span id="list:dockerfile_nodejs-14"><a href="#list:dockerfile_nodejs-14" aria-hidden="true" tabindex="-1"></a>CMD [<span class="st">&quot;node&quot;</span>,<span class="st">&quot;dist/main.js&quot;</span>]</span></code></pre></div>
<h3 id="java">Java</h3>
<p>La containerizzazione del middleware ha richiesto alcuni passaggi
aggiuntivi rispetto ai servizi in Node.js. È stato necessario adottare
immagini diverse per gli stage di build e produzione, quindi usare
un’immagine di Gradle per la build, nella quale eseguire i comandi di
Gradle, e un’immagine di OpenJDK per l’esecuzione del JAR prodotto dalla
build.</p>
<p>Per la compilazione con Gradle, nonostante non sia una pratica
corretta, è stato necessario mantenere nella repository il file
gradle-wrapper.jar, in quanto non era possibile scaricarlo durante la
build all’interno delle GitHub Actions. La build non utilizza il
classico comando di Gradle per generare il file .jar, ma un task
personalizzato che si occupa di generare il fatJar del servizio, poiché
le dipendenze non venivano gestite correttamente all’interno del normale
file .jar.</p>
<div class="sourceCode" id="list:gradle_fatJar" data-language="Java"
data-caption="Task del fatJar da includere nel container"
label="list:gradle_fatJar"><pre class="sourceCode java"><code class="sourceCode java"><span id="list:gradle_fatJar-1"><a href="#list:gradle_fatJar-1" aria-hidden="true" tabindex="-1"></a>tasks<span class="op">.</span><span class="fu">register</span><span class="op">&lt;</span>Jar<span class="op">&gt;(</span><span class="st">&quot;fatJar&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="list:gradle_fatJar-2"><a href="#list:gradle_fatJar-2" aria-hidden="true" tabindex="-1"></a>    archiveBaseName<span class="op">.</span><span class="fu">set</span><span class="op">(</span><span class="st">&quot;Middleware&quot;</span><span class="op">)</span></span>
<span id="list:gradle_fatJar-3"><a href="#list:gradle_fatJar-3" aria-hidden="true" tabindex="-1"></a>    manifest <span class="op">{</span></span>
<span id="list:gradle_fatJar-4"><a href="#list:gradle_fatJar-4" aria-hidden="true" tabindex="-1"></a>        attributes<span class="op">[</span><span class="st">&quot;Main-Class&quot;</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;server.Main&quot;</span></span>
<span id="list:gradle_fatJar-5"><a href="#list:gradle_fatJar-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="list:gradle_fatJar-6"><a href="#list:gradle_fatJar-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">from</span><span class="op">(</span>sourceSets<span class="op">.</span><span class="fu">main</span><span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">output</span><span class="op">)</span></span>
<span id="list:gradle_fatJar-7"><a href="#list:gradle_fatJar-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dependsOn</span><span class="op">(</span>configurations<span class="op">.</span><span class="fu">runtimeClasspath</span><span class="op">)</span></span>
<span id="list:gradle_fatJar-8"><a href="#list:gradle_fatJar-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">from</span><span class="op">({</span> configurations<span class="op">.</span><span class="fu">runtimeClasspath</span><span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">filter</span> <span class="op">{</span> it<span class="op">.</span><span class="fu">name</span><span class="op">.</span><span class="fu">endsWith</span><span class="op">(</span><span class="st">&quot;jar&quot;</span><span class="op">)</span> <span class="op">}.</span><span class="fu">map</span> <span class="op">{</span> <span class="fu">zipTree</span><span class="op">(</span>it<span class="op">)</span> <span class="op">}</span> <span class="op">})</span></span>
<span id="list:gradle_fatJar-9"><a href="#list:gradle_fatJar-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dependsOn</span><span class="op">(</span><span class="st">&quot;compileJava&quot;</span><span class="op">)</span></span>
<span id="list:gradle_fatJar-10"><a href="#list:gradle_fatJar-10" aria-hidden="true" tabindex="-1"></a>    duplicatesStrategy <span class="op">=</span> DuplicatesStrategy<span class="op">.</span><span class="fu">EXCLUDE</span> <span class="co">// Puoi utilizzare altre strategie come DuplicatesStrategy.WARN per avvisare ma non fermare la build</span></span>
<span id="list:gradle_fatJar-11"><a href="#list:gradle_fatJar-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="angular">Angular</h3>
<p>La containerizzazione del frontend ha richiesto l’utilizzo di
un’immagine di Node.js per lo stage di build, mentre per l’esecuzione è
stata utilizzata un’immagine di Nginx. Come citato nella sezione <a
href="#Nginx" data-reference-type="ref" data-reference="Nginx">7.2.1</a>
Nginx serve per eseguire l’applicazione all’interno del container e per
poterla raggiungere dall’esterno.</p>
<h2 id="monitoraggio">Monitoraggio</h2>
<p>In un progetto composto da microservizi deployati con container, il
monitoraggio è essenziale per garantire il corretto funzionamento e la
performance ottimale del sistema. Per realizzare un monitoraggio
efficace dei container, sono stati impiegati i container di Grafana,
Prometheus e cAdvisor. Si ringrazia il lavoro di <a
href="https://medium.com/@sohammohite/docker-container-monitoring-with-cadvisor-prometheus-and-grafana-using-docker-compose-b47ec78efbc"><u>Soham
Mohite</u></a> per la configurazione e l’integrazione di questi
strumenti.</p>
<p><img src="report/img/monitor_schema.jpg" style="width:14cm"
alt="image" /><br />
</p>
<h3 id="grafana">Grafana</h3>
<p>Grafana è uno strumento open-source per la visualizzazione e
l’analisi delle metriche raccolte. Viene utilizzato per creare dashboard
personalizzate che mostrano lo stato e le performance dei microservizi.
Con Grafana, è possibile configurare alert che notificano immediatamente
eventuali problemi nel sistema, permettendo una risposta rapida e
mirata.</p>
<h3 id="prometheus">Prometheus</h3>
<p>Prometheus è un sistema di monitoraggio e di allarme progettato per
raccogliere e memorizzare metriche in serie temporali. È stato
configurato per raccogliere metriche dai container dei microservizi e da
cAdvisor. Prometheus esegue la raccolta dei dati a intervalli regolari e
li memorizza in un database time-series, rendendoli disponibili per
l’analisi e la visualizzazione in Grafana.</p>
<h3 id="cadvisor">cAdvisor</h3>
<p>cAdvisor (Container Advisor) è uno strumento che fornisce
informazioni sulle risorse utilizzate dai container, come CPU, memoria,
rete e disco. È stato integrato con Prometheus per raccogliere e
esportare le metriche dei container. cAdvisor offre una visione
dettagliata delle performance di ogni container, aiutando a identificare
e risolvere problemi di utilizzo delle risorse.</p>
<h3 id="integrazione-e-configurazione">Integrazione e
Configurazione</h3>
<p>L’integrazione di Grafana, Prometheus e cAdvisor ha permesso di
creare un sistema di monitoraggio completo. I container di cAdvisor
raccolgono le metriche di utilizzo delle risorse dai container dei
microservizi e le esportano a Prometheus. Prometheus memorizza queste
metriche e le rende disponibili per la visualizzazione in Grafana. Le
dashboard di Grafana sono configurate per mostrare le metriche chiave e
fornire un’analisi dettagliata dello stato del sistema.</p>
<p>La configurazione di questi strumenti è stata gestita tramite Docker
Compose, permettendo una facile implementazione e scalabilità del
sistema di monitoraggio. Le variabili d’ambiente e i file di
configurazione sono stati impostati per garantire la corretta
connessione e funzionamento dei container di monitoraggio.</p>
<div class="sourceCode" id="list:docker_compose_monitoring"
data-language="Python"
data-caption="Esempio di configurazione Docker Compose"
label="list:docker_compose_monitoring"><pre
class="sourceCode python"><code class="sourceCode python"><span id="list:docker_compose_monitoring-1"><a href="#list:docker_compose_monitoring-1" aria-hidden="true" tabindex="-1"></a>cadvisor:</span>
<span id="list:docker_compose_monitoring-2"><a href="#list:docker_compose_monitoring-2" aria-hidden="true" tabindex="-1"></a>    container_name: cadvisor</span>
<span id="list:docker_compose_monitoring-3"><a href="#list:docker_compose_monitoring-3" aria-hidden="true" tabindex="-1"></a>    image: gcr.io<span class="op">/</span>cadvisor<span class="op">/</span>cadvisor:latest</span>
<span id="list:docker_compose_monitoring-4"><a href="#list:docker_compose_monitoring-4" aria-hidden="true" tabindex="-1"></a>    ports:</span>
<span id="list:docker_compose_monitoring-5"><a href="#list:docker_compose_monitoring-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;8080:8080&quot;</span></span>
<span id="list:docker_compose_monitoring-6"><a href="#list:docker_compose_monitoring-6" aria-hidden="true" tabindex="-1"></a>    volumes:</span>
<span id="list:docker_compose_monitoring-7"><a href="#list:docker_compose_monitoring-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;/:/rootfs&quot;</span></span>
<span id="list:docker_compose_monitoring-8"><a href="#list:docker_compose_monitoring-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;/var/run:/var/run&quot;</span></span>
<span id="list:docker_compose_monitoring-9"><a href="#list:docker_compose_monitoring-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;/sys:/sys&quot;</span></span>
<span id="list:docker_compose_monitoring-10"><a href="#list:docker_compose_monitoring-10" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;/var/lib/docker/:/var/lib/docker&quot;</span></span>
<span id="list:docker_compose_monitoring-11"><a href="#list:docker_compose_monitoring-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;/dev/disk/:/dev/disk&quot;</span></span>
<span id="list:docker_compose_monitoring-12"><a href="#list:docker_compose_monitoring-12" aria-hidden="true" tabindex="-1"></a>    privileged: true</span>
<span id="list:docker_compose_monitoring-13"><a href="#list:docker_compose_monitoring-13" aria-hidden="true" tabindex="-1"></a>    devices:</span>
<span id="list:docker_compose_monitoring-14"><a href="#list:docker_compose_monitoring-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;/dev/kmsg&quot;</span></span>
<span id="list:docker_compose_monitoring-15"><a href="#list:docker_compose_monitoring-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:docker_compose_monitoring-16"><a href="#list:docker_compose_monitoring-16" aria-hidden="true" tabindex="-1"></a>  prometheus:</span>
<span id="list:docker_compose_monitoring-17"><a href="#list:docker_compose_monitoring-17" aria-hidden="true" tabindex="-1"></a>    container_name: prometheus</span>
<span id="list:docker_compose_monitoring-18"><a href="#list:docker_compose_monitoring-18" aria-hidden="true" tabindex="-1"></a>    image: prom<span class="op">/</span>prometheus:latest</span>
<span id="list:docker_compose_monitoring-19"><a href="#list:docker_compose_monitoring-19" aria-hidden="true" tabindex="-1"></a>    ports:</span>
<span id="list:docker_compose_monitoring-20"><a href="#list:docker_compose_monitoring-20" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;9090:9090&quot;</span></span>
<span id="list:docker_compose_monitoring-21"><a href="#list:docker_compose_monitoring-21" aria-hidden="true" tabindex="-1"></a>    volumes:</span>
<span id="list:docker_compose_monitoring-22"><a href="#list:docker_compose_monitoring-22" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;./prometheus.yml:/etc/prometheus/prometheus.yml&quot;</span></span>
<span id="list:docker_compose_monitoring-23"><a href="#list:docker_compose_monitoring-23" aria-hidden="true" tabindex="-1"></a>    privileged: true</span>
<span id="list:docker_compose_monitoring-24"><a href="#list:docker_compose_monitoring-24" aria-hidden="true" tabindex="-1"></a>    depends_on:</span>
<span id="list:docker_compose_monitoring-25"><a href="#list:docker_compose_monitoring-25" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> cadvisor</span>
<span id="list:docker_compose_monitoring-26"><a href="#list:docker_compose_monitoring-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:docker_compose_monitoring-27"><a href="#list:docker_compose_monitoring-27" aria-hidden="true" tabindex="-1"></a>  grafana:</span>
<span id="list:docker_compose_monitoring-28"><a href="#list:docker_compose_monitoring-28" aria-hidden="true" tabindex="-1"></a>    container_name: grafana</span>
<span id="list:docker_compose_monitoring-29"><a href="#list:docker_compose_monitoring-29" aria-hidden="true" tabindex="-1"></a>    image: grafana<span class="op">/</span>grafana:latest</span>
<span id="list:docker_compose_monitoring-30"><a href="#list:docker_compose_monitoring-30" aria-hidden="true" tabindex="-1"></a>    ports:</span>
<span id="list:docker_compose_monitoring-31"><a href="#list:docker_compose_monitoring-31" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;3000:3000&quot;</span></span>
<span id="list:docker_compose_monitoring-32"><a href="#list:docker_compose_monitoring-32" aria-hidden="true" tabindex="-1"></a>    environment:</span>
<span id="list:docker_compose_monitoring-33"><a href="#list:docker_compose_monitoring-33" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> GF_PATHS_PROVISIONING<span class="op">=/</span>etc<span class="op">/</span>grafana<span class="op">/</span>provisioning</span>
<span id="list:docker_compose_monitoring-34"><a href="#list:docker_compose_monitoring-34" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> DS_PROMETHEUS<span class="op">=</span>prometheus</span>
<span id="list:docker_compose_monitoring-35"><a href="#list:docker_compose_monitoring-35" aria-hidden="true" tabindex="-1"></a>    volumes:</span>
<span id="list:docker_compose_monitoring-36"><a href="#list:docker_compose_monitoring-36" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;grafana-data:/var/lib/grafana&quot;</span></span>
<span id="list:docker_compose_monitoring-37"><a href="#list:docker_compose_monitoring-37" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;./datasources.yml:/etc/grafana/provisioning/datasources/datasources.yml&quot;</span></span>
<span id="list:docker_compose_monitoring-38"><a href="#list:docker_compose_monitoring-38" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;./dashboard.json:/var/lib/grafana/dashboards/dashboard.json&quot;</span></span>
<span id="list:docker_compose_monitoring-39"><a href="#list:docker_compose_monitoring-39" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">&quot;./default.yaml:/etc/grafana/provisioning/dashboards/default.yaml&quot;</span></span>
<span id="list:docker_compose_monitoring-40"><a href="#list:docker_compose_monitoring-40" aria-hidden="true" tabindex="-1"></a>    privileged: true</span>
<span id="list:docker_compose_monitoring-41"><a href="#list:docker_compose_monitoring-41" aria-hidden="true" tabindex="-1"></a>    depends_on:</span>
<span id="list:docker_compose_monitoring-42"><a href="#list:docker_compose_monitoring-42" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> prometheus</span></code></pre></div>
<p>Con questa configurazione, il sistema di monitoraggio offre una
visione completa delle performance e dello stato dei microservizi,
permettendo di mantenere un’operatività ottimale e di intervenire
prontamente in caso di anomalie.</p>
<h1 id="ch:con">Conclusions and Future Work</h1>
<h2 id="conclusioni">Conclusioni</h2>
<p>L’architettura basata su micro-servizi si è rivelata una scelta
altamente vantaggiosa per il progetto, garantendo modularità,
scalabilità e resilienza. Ogni micro-servizio è stato progettato per
gestire specifiche funzionalità, e la loro integrazione avviene tramite
API REST e websocket orchestrate da un middleware centrale, che facilita
una comunicazione efficiente e ben strutturata tra le componenti del
sistema. L’adozione di Docker ha semplificato ulteriormente il processo
di deploy, offrendo un ambiente di esecuzione coerente e adattabile,
capace di gestire le diverse esigenze di configurazione e scaling e
affidabilità.</p>
<p>L’architettura basata su micro-servizi si è rivelata una scelta
altamente vantaggiosa per il progetto, garantendo modularità,
scalabilità e resilienza. Questo approccio consente una maggiore
flessibilità nello sviluppo, permettendo ai team di lavorare in modo
indipendente su componenti diverse, riducendo al contempo le
interdipendenze e i conflitti di integrazione.</p>
<p>Quest’integrazione avviene tramite API REST e websocket orchestrate
da un middleware centrale, che facilita una comunicazione efficiente e
ben strutturata tra le componenti del sistema. Questo sistema
intermediario, gestisce le richieste e il bilanciamento del carico,
garantendo che i dati siano trasferiti in modo rapido tra i vari
micro-servizi. Inoltre, l’uso di websocket consente una comunicazione
bidirezionale in near real-time, migliorando la reattività
dell’applicazione.</p>
<p>L’adozione di Docker ha semplificato ulteriormente il processo di
deploy, offrendo un ambiente di esecuzione coerente e adattabile.
Docker, infatti, permette di incapsulare ogni micro-servizio in un
container, che include tutte le dipendenze necessarie, eliminando
problemi legati alle differenze tra ambienti di sviluppo e di test.
Questo approccio non solo facilita la distribuzione, ma migliora anche
la portabilità delle applicazioni e la gestione delle risorse. Grazie a
Docker, è possibile scalare orizzontalmente i micro-servizi in base alle
necessità, rispondendo rapidamente alle variazioni del carico di lavoro
e garantendo così un’elevata disponibilità e affidabilità del
sistema.</p>
<p>Infine, l’architettura a micro-servizi, risulta essere altamente
resiliente. In caso di fallimento di un singolo micro-servizio, il
sistema può continuare a funzionare, con la possibilità di isolare e
risolvere il problema senza impattare l’intera applicazione. Questo
approccio modulare non solo migliora la robustezza del sistema, ma
facilita anche l’implementazione di nuove funzionalità e l’aggiornamento
di quelle esistenti, rendendo l’intero processo di sviluppo più agile e
reattivo.</p>
</body>
</html>
